# nehan.js

## Introduction

nehan.js is dynamic and logical html layout engine written in javascript, especially focused on generating **logical paged media** asynchronously.

Almost all html5 tags are supported, and further more, vertical layout(lr-tb, rl-tb) supported.

Available on IE8+, Firefox3.5+, Google Chrome4+, Safari3+, Opera10+ etc.

## Install

Include css, js in the ``<head>``

```html
<link href="/path/to/nehan.css" type="text/css" rel="stylesheet">
<script src="/path/to/nehan.js" type="text/javascript"></script>
```

## Demo & Document

See [demo and document](http://tategakibunko.github.io/nehan.js).

## Screenshot

These screenshots are layout result of [jekyll-nehan](https://github.com/tategakibunko/jekyll-nehan).

### 1. horizontal paged media
<img src="https://raw.github.com/tategakibunko/jekyll-nehan/master/assets/sshot-hori.png" width="300" height="160" />

### 2. vertical paged media
<img src="https://raw.github.com/tategakibunko/jekyll-nehan/master/assets/sshot-vert.png" width="300" height="160" />

## Quick Start 1 (for simple single page layout)

```javascript
// NehanPagedElement is available for Nehan.version >= 5.0.3
var pe = Nehan.createPagedElement();

// before calling setContent, set 'body' style of this paged-element.
// notice that you can't use camel-cased css property.
pe.setStyle("body", {
  "flow":"lr-tb",
  //"flow":"tb-rl", // for Japanese vertical
  "font-size":16, // use 'font-size' instead of 'fontSize'!
  "width":640,
  "height":480
});

// by setContent, paged-media is asynchronously generated.
pe.setContent("<h1>hello, nehan.js</h1>", {
  onProgress : function(tree){}, // tree.pageNo, tree.percent is available.
  onComplete : function(time){}
});

// set paged-media element to some target dom.
document.getElementById("result").appendChild(pe.getElement());

// set next/prev callback to some clickable target.
document.getElementById("next").onclick = function(){ pe.setNextPage() };
document.getElementById("prev").onclick = function(){ pe.setPrevPage() };
```

## Quick Start 2 (more flexible way)

```javascript
// create layout engine.
var engine = Nehan.setup();

// set body size(= page size)
engine.setStyle("body", {
  "flow":"lr-tb", // or "tb-rl"(vertical)
  "font-size":16,
  "width":640,
  "height":480
});

// generate page stream from engine.
var page_stream = engine.createPageStream("<h1>hello, nehan.js</h1>");

// get target dom.
var target_dom = document.getElementById("my-page-document");

// start parsing
page_stream.asyncGet({
  // called when each abstract layout tree is generated.
  onProgress: function(stream, tree){
    var page = stream.getPage(tree.pageNo); // tree -> page object
    target_dom.appendChild(page.element);
  },
  // called when all pages are generated.
  onComplete: function(stream, time){
    console.log("finished!! => %fmsec", time);
  }
});
```

### Styling(engine local style)

Engine local style is only available for the single engine.

```javascript
// create layout engine.
var engine = Nehan.setup();

// set engine local style.
engine.setStyles({
  // notice that 'body size' = 'page size'.
  "body":{
    "flow":"lr-tb", // document mode horizontal
    //"flow":"tb-rl", // document mode vertical(Japanese)
    "width":"80%", // percent size from parent, 'screen.width' at this case.
    // "width":900, // direct size
    "height":"60%", // percent size from parent, 'screen.height' at this case.
    "font-size":16, // notice that camel-case(fontSize) is not allowed.
    "font-family":"Meiryo",
    // functional property is supported.
    "background-color":function(prop_context){
      return "white";
    },
    // onload callback is called after all the properties of this selector('body' at this case) are loaded.
    "onload":function(selector_context){
      var markup = selector_context.getMarkup();
      console.log(markup.getName()); // => "body"
      console.log(markup.getAttr("foo")); // => 'aaa' if <body foo='aaa'>
      console.log(markup.getData("fuga")); // => '10' if <body data-fuga='10'>
      console.log(markup.getContent()); // => 'hello' if <body>hello</body>
      console.log(markup.getCssAttr("font-family")); // => 'Meiryo'

      // you can overwrite content dynamically like this.
      markup.setContent(markup.getContent() + "!!");

      // other context variables....
      console.log("nth-child is %d", selector_context.getChildIndex());
      console.log("nth-child-of-type is %d", selector_context.getChildIndexOfType());
      console.log("rest extent size is %d", selector_context.getRestExtent());
      console.log("rest measure size is %d", selector_context.getRestMeasure());
    },
    // oncreate callback is called when this element is actually generated by evaluator.
    "oncreate":function(dom, selector_context){
      alert("body element is created");
    }
  },
  // you can use regexp as element name like this.
  "header /h[1-6]/":{
    "font-weight":"bold",
    // notice that directions in nehan.js are defined as 'logical' like this.
    "margin":{
      "after":"1.5em" // 'after' is 'bottom' if body.flow = 'lr-tb'('left' if 'tb-rl').
    }
  }
});
```

### important notice about css properties in nehan.js
Notice that camel case is not allowed for css properties.

- "font-size":16 => OK
- "fontSize":16 => NG

## Styling(global style)

Instead of <code>engine.setStyle</code> or <code>pe.setStyle</code>, <code>Nehan.setStyle</code> is used to set **global style**.

Global styles are shared by all engines created in same window.

```javascript
Nehan.setStyle("body", {
  "font-size":16
});

// multiple values by setStyles.
Nehan.setStyles({
  "body":{
    "color":"#ccc"
  },
  "h1":{
    "font-size":"3em"
  }
});
```

## License

MIT License
