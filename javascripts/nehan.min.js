/*
 nehan.js
 Copyright (C) 2010-2014 Watanabe Masaki<lambda.watanabe[at]gmail.com>
 http://tb.antiscroll.com/docs/nehan/

 licensed under MIT license.

 Permission is hereby granted, free of charge, to any person
 obtaining a copy of this software and associated documentation
 files (the "Software"), to deal in the Software without
 restriction, including without limitation the rights to use,
 copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the
 Software is furnished to do so, subject to the following
 conditions:

 The above copyright notice and this permission notice shall be
 included in all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
 OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
 HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
 WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
 OTHER DEALINGS IN THE SOFTWARE.
*/

var Nehan;Nehan||(Nehan={}),Nehan.setup=function(a){var b=a||{},c={lang:"ja-JP",debug:!1,kerning:!0,justify:!0,maxRollbackCount:40,minBlockScaleDownRate:65,useVerticalGlyphIfEnable:!0,useStrictWordMetrics:!0,iboxEnable:!1,maxBase:36,lexingBufferLen:2e3,defaultLinkTitleLength:16},d={root:"document",direction:"vert",hori:"lr-tb",vert:"tb-rl",width:800,height:580,fontSize:16,maxFontSize:64,rubyRate:.5,boldRate:.5,lineRate:2,fontColor:"000000",linkColor:"0000FF",fontImgRoot:"http://nehan.googlecode.com/hg/char-img",vertFontFamily:"'ヒラギノ明朝 Pro W3','Hiragino Mincho Pro','HiraMinProN-W3','IPA明朝','IPA Mincho', 'Meiryo','メイリオ','ＭＳ 明朝','MS Mincho', monospace",horiFontFamily:"'Meiryo','メイリオ','Hiragino Kaku Gothic Pro','ヒラギノ角ゴ Pro W3','Osaka','ＭＳ Ｐゴシック', monospace",fontSizeAbs:{"xx-large":"33px","x-large":"24px",large:"18px",medium:"16px",small:"13px","x-small":"10px","xx-small":"8px",larger:"1.2em",smaller:"0.8em"},getMeasure:function(a){return this[a.getPropMeasure()]},getExtent:function(a){return this[a.getPropExtent()]},getStdFontFamily:function(){return"vert"===this.direction?this.vertFontFamily:this.horiFontFamily},getStdBoxFlow:function(){var a=this[this.direction];return $.getByName(a)},getStdVertFlow:function(){return $.getByName(this.vert)},getStdHoriFlow:function(){return $.getByName(this.hori)},getHoriIndir:function(){return this.hori.split("-")[0]},getRtFontSize:function(a){var b=f.rt||null,c=b?b["font-size"]:null;return null===b||null===c?Math.round(this.rubyRate*a):j.getUnitSize(c,a)},getPaletteFontColor:function(a){return a.getValue().toLowerCase()!==this.fontColor.toLowerCase()?a.getPaletteValue():this.fontColor}},e=function(){var a,b,c,d,e=navigator.appName,f=navigator.userAgent.toLowerCase(),g=f.indexOf("trident")>=0&&f.indexOf("msie")<0;if(g)a="msie",d=f.match(/rv:([\.\d]+)/i),b=d?parseInt(d[1],10):"";else{var h=f.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/);h?(d=f.match(/version\/([\.\d]+)/i),d&&(h[2]=d[1]),a=h[1].toLowerCase(),b=parseInt(h[2],10)):(a=e.toLowerCase(),b=parseInt(navigator.appVersion,10))}var i="msie"===a,j=f.indexOf("windows")>=0,k=f.indexOf("macintosh")>=0,l=a.indexOf("chrome")>=0,m=a.indexOf("safari")>=0,n=-1!=f.indexOf("iphone"),o=-1!=f.indexOf("ipod"),p=-1!=f.indexOf("ipad"),q=n||o||p,r=-1!=f.indexOf("android"),s=q||r,t=-1!=f.indexOf("webkit"),c=g||!(i&&8>=b),u=l&&(j||k)&&b>=24,v=m&&b>=5,w=u||v;return{version:b,isIE:i,isTrident:g,isChrome:l,isWebkit:t,isIphone:n,isIpod:o,isIpad:p,isIphoneFamily:q,isAndroidFamily:r,isSmartPhone:s,isTransformEnable:c,isVerticalGlyphEnable:w}}(),f={a:{display:"inline"},abbr:{display:"inline"},address:{display:"inline","font-style":"italic",section:!0},area:{},article:{display:"block",section:!0},aside:{display:"block",section:!0},audio:{},b:{display:"inline","font-weight":"bold"},base:{},bdi:{display:"inline"},bdo:{display:"inline"},blockquote:{color:"#666666",display:"block","section-root":!0,padding:{start:"1em",end:"1em",before:"0.5em",after:"0.5em"},margin:{after:"1.5em"}},body:{display:"block","section-root":!0},br:{display:"inline"},button:{display:"inline",interactive:!0},canvas:{display:"inline",embeddable:!0},caption:{display:"table-caption","text-align":"center",margin:{after:"0.5em"}},cite:{display:"inline"},code:{"font-family":"'andale mono', 'lucida console', monospace",display:"inline"},col:{display:"table-column"},colgroup:{display:"table-column-group"},command:{},datalist:{},dd:{display:"block",margin:{start:"1em",end:"1em",after:"1.6em"}},del:{color:"#666666",display:"inline"},details:{display:"block","section-root":!0},dfn:{display:"inline","font-style":"italic"},div:{display:"block"},dl:{display:"block"},dt:{display:"block","font-weight":"bold",margin:{after:"0.2em"}},em:{display:"inline","font-style":"italic"},embed:{},fieldset:{display:"block","section-root":!0,padding:{start:"1em",end:"0.2em",before:"0.2em",after:"1em"},margin:{after:"1.5em"},"border-width":"1px"},figure:{display:"block","section-root":!0},figcaption:{display:"block","text-align":"center","font-size":"0.8em"},footer:{display:"block",section:!0},font:{display:"inline"},form:{display:"block"},h1:{display:"block","break-before":"always","line-rate":1.4,"font-size":"2.4em","font-family":"'Meiryo','メイリオ','Hiragino Kaku Gothic Pro','ヒラギノ角ゴ Pro W3','Osaka','ＭＳ Ｐゴシック', monospace",margin:{after:"0.5em"}},h2:{display:"block","line-rate":1.4,"font-size":"2.0em","font-family":"'Meiryo','メイリオ','Hiragino Kaku Gothic Pro','ヒラギノ角ゴ Pro W3','Osaka','ＭＳ Ｐゴシック', monospace",margin:{after:"0.75em"}},h3:{display:"block","line-rate":1.4,"font-size":"1.6em","font-family":"'Meiryo','メイリオ','Hiragino Kaku Gothic Pro','ヒラギノ角ゴ Pro W3','Osaka','ＭＳ Ｐゴシック', monospace",margin:{after:"1em"}},h4:{display:"block","line-rate":1.4,"font-size":"1.4em","font-family":"'Meiryo','メイリオ','Hiragino Kaku Gothic Pro','ヒラギノ角ゴ Pro W3','Osaka','ＭＳ Ｐゴシック', monospace",margin:{after:"1.25em"}},h5:{display:"block","line-rate":1.4,"font-size":"1.0em","font-weight":"bold","font-family":"'Meiryo','メイリオ','Hiragino Kaku Gothic Pro','ヒラギノ角ゴ Pro W3','Osaka','ＭＳ Ｐゴシック', monospace",margin:{after:"1.5em"}},h6:{display:"block","line-rate":1.4,"font-weight":"bold","font-family":"'Meiryo','メイリオ','Hiragino Kaku Gothic Pro','ヒラギノ角ゴ Pro W3','Osaka','ＭＳ Ｐゴシック', monospace","font-size":"1.0em"},head:{display:"none"},header:{display:"block",section:!0},hr:{display:"block","box-sizing":"content-box","border-color":"#b8b8b8","border-style":"solid",margin:{after:"1em"},extent:"1px","border-width":{before:"1px"}},"hr.nehan-space":{"border-width":"0px"},"hr.nehan-pbr":{"border-width":"0px","break-after":"always"},html:{display:"block"},i:{display:"inline"},iframe:{display:"block",embeddable:!0},ins:{},img:{display:"inline","box-sizing":"content-box"},input:{display:"inline",interactive:!0},kbd:{display:"inline"},keygen:{},label:{display:"inline"},legend:{display:"block","font-weight":"bold","line-rate":1.5},li:{display:"list-item",margin:{after:"0.6em"}},"li-mark":{display:"block"},"li-body":{display:"block"},link:{meta:!0},main:{display:"block"},map:{},mark:{display:"inline"},menu:{display:"block"},meta:{meta:!0},meter:{display:"inline"},nav:{display:"block",section:!0},noscript:{meta:!0},object:{display:"inline",embeddable:!0},ol:{display:"block","list-style-image":"none","list-style-position":"outside","list-style-type":"decimal",margin:{before:"1em"}},"ol ol":{margin:{before:"0em"}},"ol ul":{margin:{before:"0em"}},optgroup:{},option:{},output:{},p:{display:"block",margin:{after:"1.5em"}},param:{},pre:{display:"block","white-space":"pre"},progress:{display:"inline"},q:{display:"block"},rb:{display:"inline"},rp:{display:"inline"},ruby:{display:"inline"},rt:{"font-size":"0.5em","line-rate":1,display:"inline"},s:{display:"inline"},samp:{display:"inline"},script:{display:"inline",meta:!0},section:{display:"block",section:!0},select:{},small:{display:"inline","font-size":"0.8em"},source:{},span:{display:"inline"},strong:{display:"inline","font-weight":"bold"},style:{display:"inline",meta:!0},sub:{display:"inine"},summary:{display:"inline"},sup:{display:"inine"},table:{display:"table",embeddable:!0,"table-layout":"fixed","background-color":"white","border-collapse":"collapse","border-color":"#a8a8a8","border-style":"solid","border-width":{start:"1px",before:"1px"},margin:{start:"0.5em",end:"0.5em",after:"1.6em"}},tbody:{display:"table-row-group","border-collapse":"inherit"},td:{display:"table-cell","section-root":!0,"border-width":{end:"1px"},"border-color":"#a8a8a8","border-collapse":"inherit","border-style":"solid",padding:{start:"0.5em",end:"0.5em",before:"0.4em",after:"0.4em"}},textarea:{display:"inline",embeddable:!0,interactive:!0},tfoot:{display:"table-footer-group","border-color":"#a8a8a8","border-collapse":"inherit","border-style":"solid","font-style":"italic"},th:{display:"table-cell","line-rate":1.4,"border-width":{end:"1px"},"border-color":"#a8a8a8","border-collapse":"inherit","border-style":"solid",padding:{start:"0.5em",end:"0.5em",before:"0.4em",after:"0.4em"}},thead:{display:"table-header-group","font-weight":"bold","background-color":"#c3d9ff","border-color":"#a8a8a8","border-collapse":"inherit","border-style":"solid"},time:{display:"inline"},title:{meta:!0},tr:{display:"table-row","border-collapse":"inherit","border-color":"#a8a8a8","border-style":"solid","border-width":{after:"1px"}},track:{},u:{display:"inline"},ul:{display:"block","list-style-image":"none","list-style-type":"disc","list-style-position":"outside",margin:{before:"1em"}},"ul ul":{margin:{before:"0em"}},"ul ol":{margin:{before:"0em"}},"var":{display:"inline"},video:{display:"inline",embeddable:!0},wbr:{display:"inline"},"?xml":{},"!doctype":{},"first-line":{display:"block"},"page-break":{display:"block"},pbr:{display:"block"},"end-page":{display:"block"},".nehan-rounded":{padding:["1.6em","1.0em","1.6em","1.0em"],"border-radius":"10px"},".nehan-xx-large":{"font-size":d.fontSizeAbs["xx-large"]},".nehan-x-large":{"font-size":d.fontSizeAbs["x-large"]},".nehan-large":{"font-size":d.fontSizeAbs.large},".nehan-medium":{"font-size":d.fontSizeAbs.medium},".nehan-small":{"font-size":d.fontSizeAbs.small},".nehan-x-small":{"font-size":d.fontSizeAbs["x-small"]},".nehan-xx-small":{"font-size":d.fontSizeAbs["xx-small"]},".nehan-larger":{"font-size":d.fontSizeAbs.larger},".nehan-smaller":{"font-size":d.fontSizeAbs.smaller},".nehan-disp-block":{display:"block"},".nehan-disp-inline":{display:"inline"},".nehan-disp-iblock":{display:"inline-block"},".nehan-ta-start":{"text-align":"start"},".nehan-ta-center":{"text-align":"center"},".nehan-ta-end":{"text-align":"end"},".nehan-float-start":{"float":"start"},".nehan-float-end":{"float":"end"},".nehan-flow-lr-tb":{flow:"lr-tb"},".nehan-flow-tb-rl":{flow:"tb-rl"},".nehan-flow-tb-lr":{flow:"tb-lr"},".nehan-flow-rl-tb":{flow:"rl-tb"},".nehan-flow-flip":{flow:"flip"},".nehan-lsp-inside":{"list-style-position":"inside"},".nehan-lsp-outside":{"list-style-position":"outside"},".nehan-lst-none":{"list-style-type":"none"},".nehan-lst-decimal":{"list-style-type":"decimal"},".nehan-lst-disc":{"list-style-type":"disc"},".nehan-lst-circle":{"list-style-type":"circle"},".nehan-lst-square":{"list-style-type":"square"},".nehan-lst-decimal-leading-zero":{"list-style-type":"decimal-leading-zero"},".nehan-lst-lower-alpha":{"list-style-type":"lower-alpha"},".nehan-lst-upper-alpha":{"list-style-type":"upper-alpha"},".nehan-lst-lower-latin":{"list-style-type":"lower-latin"},".nehan-lst-upper-latin":{"list-style-type":"upper-latin"},".nehan-lst-lower-roman":{"list-style-type":"lower-roman"},".nehan-lst-upper-roman":{"list-style-type":"upper-roman"},".nehan-lst-lower-greek":{"list-style-type":"lower-greek"},".nehan-lst-upper-greek":{"list-style-type":"upper-greek"},".nehan-lst-cjk-ideographic":{"list-style-type":"cjk-ideographic"},".nehan-lst-hiragana":{"list-style-type":"hiragana"},".nehan-lst-hiragana-iroha":{"list-style-type":"hiragana-iroha"},".nehan-lst-katakana":{"list-style-type":"katakana"},".nehan-lst-katakana-iroha":{"list-style-type":"katakana-iroha"},".nehan-tcy":{"text-combine":"horizontal"},".nehan-text-combine":{"text-combine":"horizontal"},".nehan-empha-dot-filled":{"text-emphasis-style":"filled dot"},".nehan-empha-dot-open":{"text-emphasis-style":"open dot"},".nehan-empha-circle-filled":{"text-emphasis-style":"filled circle"},".nehan-empha-circle-open":{"text-emphasis-style":"open circle"},".nehan-empha-double-circle-filled":{"text-emphasis-style":"filled double-circle"},".nehan-empha-double-circle-open":{"text-emphasis-style":"open double-circle"},".nehan-empha-triangle-filled":{"text-emphasis-style":"filled triangle"},".nehan-empha-triangle-open":{"text-emphasis-style":"open triangle"},".nehan-empha-sesame-filled":{"text-emphasis-style":"filled sesame"},".nehan-empha-sesame-open":{"text-emphasis-style":"open sesame"},".nehan-drop-caps::first-letter":{display:"block","box-sizing":"content-box",width:"1em",height:"1em","float":"start","line-rate":1,"font-size":"4em"},".nehan-line-no-ruby":{"line-rate":1},".nehan-gap-start":{margin:{start:"1em"}},".nehan-gap-end":{margin:{end:"1em"}},".nehan-gap-after":{margin:{after:"1em"}},".nehan-gap-before":{margin:{before:"1em"}}},g={};g.extend=function(a,b){function c(){}c.prototype=b.prototype,a.superClass_=b.prototype,a.prototype=new c,a.prototype.constructor=a};var h={iter:function(a,b){for(var c=0,d=a.length;d>c;c++)b(a[c])},iteri:function(a,b){for(var c=0,d=a.length;d>c;c++)b(c,a[c])},reviter:function(a,b){for(var c=a.length-1;c>=0;c--)b(a[c])},reviteri:function(a,b){for(var c=a.length-1;c>=0;c--)b(c,a[c])},forall:function(a,b){for(var c=0,d=a.length;d>c;c++)if(!b(a[c]))return!1;return!0},map:function(a,b){for(var c=[],d=0,e=a.length;e>d;d++)c[d]=b(a[d]);return c},mapi:function(a,b){for(var c=[],d=0,e=a.length;e>d;d++)c[d]=b(d,a[d]);return c},fold:function(a,b,c){for(var d=b,e=0,f=a.length;f>e;e++)d=c(d,a[e]);return d},filter:function(a,b){for(var c=[],d=0,e=a.length;e>d;d++)b(a[d])&&c.push(a[d]);return c},find:function(a,b){for(var c=0,d=a.length;d>c;c++){var e=a[c];if(b(e))return e}return null},revfind:function(a,b){for(var c=a.length-1;c>=0;c--){var d=a[c];if(b(d))return d}return null},indexOf:function(a,b){for(var c=0,d=a.length;d>c;c++){var e=a[c];if(b(e))return c}return-1},exists:function(a,b){for(var c=0,d=a.length;d>c;c++)if(b(a[c]))return!0;return!1},mem:function(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]==b)return!0;return!1},sum:function(a){return this.fold(a,0,function(a,b){return a+b})},minobj:function(a,b){var c=null,d=null;return this.iter(a,function(a){var e=b(a);(null===d||d>e)&&(c=a,d=e)}),c},maxobj:function(a,b){var c=null,d=null;return this.iter(a,function(a){var e=b(a);(null===d||e>d)&&(c=a,d=e)}),c},refcopy:function(a){for(var b=[],c=0,d=a.length;d>c;c++)b[c]=a[c];return b},count:function(a,b){for(var c=0,d=0,e=a.length;e>d;d++)b(a[d])&&c++;return c},create:function(a,b){var c=new Array(a);if("undefined"!=typeof b)for(var d=0;a>d;d++)c[d]=b;return c},first:function(a){return a[0]||null},last:function(a){var b=a.length;return 0===b?null:a[b-1]},zip:function(a,b){for(var c=[],d=0,e=Math.min(a.length,b.length);e>d;d++)c[d]=[a[d],b[d]];return c},zipObj:function(a,b){var c={};if(a.length!==b.length)throw"invalid args:List.zipObj";for(var d=0,e=a.length;e>d;d++)c[a[d]]=b[d];return c},reverse:function(a){var b=[];return this.reviter(a,function(a){b.push(a)}),b}},i={isEmpty:function(a){for(var b in a)return!1;return!0},map:function(a,b){var c={};for(var d in a)c[d]=b(a[d]);return c},each:function(a,b){for(var c in a)b(c,a[c])},iter:function(a,b){for(var c in a)b(a,c,a[c])}},j={getFontSize:function(a,b){var c=String(a).replace(/\/.+$/,""),e=d.fontSizeAbs[c]||c;return this.getUnitSize(e,b)},getUnitSize:function(a,b){var c=String(a);if(c.indexOf("rem")>0){var e=parseFloat(c.replace("rem",""));return Math.round(d.fontSize*e)}if(c.indexOf("em")>0){var f=parseFloat(c.replace("em",""));return Math.round(b*f)}if(c.indexOf("pt")>0)return Math.round(4*parseInt(c,10)/3);if(c.indexOf("%")>0)return Math.round(b*parseInt(c,10)/100);var g=parseInt(c,10);return isNaN(g)?0:g},getBoxSize:function(a,b,c){var d="string"==typeof a?a:String(a);if(d.indexOf("%")>0){var e=Math.round(c*parseInt(d,10)/100);return Math.min(c,e)}return this.getUnitSize(a,b)},getCornerSize:function(a,b){var c={};for(var d in a)c[d]=[0,0],c[d][0]=this.getUnitSize(a[d][0],b),c[d][1]=this.getUnitSize(a[d][1],b);return c},getEdgeSize:function(a,b){var c={};for(var d in a)c[d]=this.getUnitSize(a[d],b);return c}},k={trimHeadCRLF:function(a){return a.replace(/^\n+/,"")},trimFootCRLF:function(a){return a.replace(/\n+$/,"")},trimCRLF:function(a){return this.trimFootCRLF(this.trimHeadCRLF(a))},trim:function(a){return a.replace(/^\s+/,"").replace(/\s+$/,"")},cutQuote:function(a){return a.replace(/['\"]/g,"")},capitalize:function(a){return""===a?"":a.charAt(0).toUpperCase()+a.slice(1)},log:function(a,b){var c=b||10;return Math.log(a)/Math.log(c)},filenameConcat:function(a,b){return a=""===a?"":"/"===a.slice(-1)?a:a+"/",b=""===b?"":"/"===b[0]?b.substring(1,b.length):b,a+b},getCamelName:function(a){var b=this;return h.mapi(a.split("-"),function(a,c){return 0===a?c:b.capitalize(c)}).join("")}},l={convBase:function(a,b){if(0===a)return[0];for(var c=[],d=a;d>0;)c.unshift(d%b),d=Math.floor(d/b);return c}},m=function(){var a=1e3/60;return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(b,c){var d="undefined"==typeof c?a:c;window.setTimeout(b,d)}}(),n={cssVenderPrefixes:["-moz","-webkit","-o","-ms"],cssCorders:["top-left","top-right","bottom-left","bottom-right"],cssBorderRadius:["border-top-left-radius","border-top-right-radius","border-bottom-left-radius","border-bottom-right-radius"],cssBoxDirs:["top","right","bottom","left"],cssBoxDirsLogical:["before","end","after","start"],cssBoxCornersLogical:["start-before","end-before","end-after","start-after"],css2dIndex:{1:[0,0],2:[0,1]},css4dIndex:{1:[0,0,0,0],2:[0,1,0,1],3:[0,1,2,1],4:[0,1,2,3]},space:"&nbsp;",clearFix:"<div style='clear:both'></div>"},o={toString:function(a){var b=[];for(var c in a)b.push(c+":"+a[c]);return b.join(";")},addNehanPrefix:function(a){return"nehan-"+a},addNehanHeaderPrefix:function(a){return"nehan-header-"+a},addNehanTocLinkPrefix:function(a){return"nehan-toc-link-"+a}},p={escape:function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#039;").replace(/"/g,"&quot;")},attr:function(a){var b=[];for(var c in a)"undefined"!=typeof a[c]&&""!==a[c]&&b.push(c+"='"+this.escape(a[c]+"")+"'");return b==[]?"":b.join(" ")},tagWrap:function(a,b,c){return[this.tagStart(a,c||{}),b,this.tagEnd(a)].join("")},tagSingle:function(a,b){return"<"+a+" "+this.attr(b)+"/>"},tagStart:function(a,b){return"<"+a+" "+this.attr(b)+">"},tagEnd:function(a){return"</"+a+">"}},q={id:function(){return function(a){return a}},eq:function(a){return function(b){return a==b}},neq:function(a){return function(b){return a!=b}}},r={copy:function(a,b){for(var c in b)a[c]=b[c];return a},merge:function(a,b,c){for(var d in b)a[d]="undefined"==typeof c[d]?b[d]:c[d];return a},activate:function(a,b,c){return h.iter(c,function(c){b[c]&&(a[c]=b[c])}),a}},s=function(){var a=function(a){return k.trim(String(a)).replace(/;/g,"").replace(/\n/g,"")},b=function(a){return a.indexOf(" ")<0?[a]:a.split(/\s+/)},c=function(a){return a.indexOf("/")<0?[a]:a.split("/")},d=function(a){return n.css2dIndex[Math.min(a,2)]||[]},e=function(a){return n.css4dIndex[Math.min(a,4)]||[]},f=function(a,b){return h.map(b,function(b){return a[b]})},g=function(a){var b=d(a.length);return f(a,b)},i=function(a){var b=e(a.length);return f(a,b)},j=function(a){var b=n.cssBoxDirsLogical,c=i(a);return h.zipObj(b,c)},l=function(a){var b=n.cssBoxCornersLogical,c=i(a);return h.zipObj(b,c)},m=function(a){return j(b(a))},o=function(a){var d=g(c(a)),e=h.map(d,function(a){return i(b(a))}),f=h.zip(e[0],e[1]);return l(f)},p=function(a){var c=[],d=b(a),e=d.length;return e>=1&&c.push({"border-width":m(d[0])}),e>=2&&c.push({"border-style":m(d[1])}),e>=3&&c.push({"border-color":m(d[2])}),c},q=function(a){var c=[],d=b(a),e=d.length;return e>=1&&c.push({"list-style-type":m(d[0])}),e>=2&&c.push({"list-style-image":m(d[1])}),e>=3&&c.push({"list-style-position":m(d[2])}),c},r=function(){return{}},s=function(){return{}},t=function(a){var c=b(a),d=c.length;return 1===d?{inline:{pos:c[0],offset:0},block:{pos:"center",offset:0}}:d>=2&&4>d?{inline:{pos:c[0],offset:0},block:{pos:c[1],offset:0}}:d>=4?{inline:{pos:c[0],offset:c[1]},block:{pos:c[2],offset:c[3]}}:null},u=function(a){var c=b(a),d=c.length;return 1===d?{inline:c[0],block:c[0]}:d>=2?{inline:c[0],block:c[1]}:null},v=function(b,c){switch(typeof c){case"function":case"object":case"boolean":return c}switch(c=a(c),b){case"background":return s(c);case"background-position":return t(c);case"background-repeat":return u(c);case"border":return p(c);case"border-color":return m(c);case"border-radius":return o(c);case"border-style":return m(c);case"border-width":return m(c);case"font":return r(c);case"list-style":return q(c);case"margin":return m(c);case"padding":return m(c);default:return c}};return{format:function(a,b){try{return v(a,b)}catch(c){return{}}}}}(),t=function(){function a(a){this.expr=this._normalize(a),this.left=this.op=this.right=null,this._parseExpr(this.expr)}var b=/[^=^~|$*\s]+/,c=["|=","~=","^=","$=","*=","="];return a.prototype={_normalize:function(a){return a.replace(/\[/g,"").replace(/\]/g,"")},_parseSymbol:function(a){var c=a.match(b);return c?c[0]:""},_parseOp:function(a){return h.find(c,function(b){return a.indexOf(b)>=0})},_parseExpr:function(a){this.left=this._parseSymbol(a),this.left&&(a=k.trim(a.slice(this.left.length))),this.op=this._parseOp(a),this.op&&(a=k.trim(a.slice(this.op.length)),this.right=k.cutQuote(k.trim(a)))},_testHasAttr:function(a){return null!==a.getTagAttr(this.left)},_testEqual:function(a){var b=a.getTagAttr(this.left);return b===this.right},_testCaretEqual:function(a){var b=a.getTagAttr(this.left),c=new RegExp("^"+this.right);return c.test(b)},_testDollarEqual:function(a){var b=a.getTagAttr(this.left),c=new RegExp(this.right+"$");return c.test(b)},_testTildeEqual:function(a){var b=a.getTagAttr(this.left).split(/\s+/);return h.exists(b,q.eq(this.right))},_testPipeEqual:function(a){var b=a.getTagAttr(this.left);return b==this.right||b.indexOf(this.right+"-")>=0},_testStarEqual:function(a){var b=a.getTagAttr(this.left);return b.indexOf(this.right)>=0},_testOp:function(a){switch(this.op){case"=":return this._testEqual(a);case"^=":return this._testCaretEqual(a);case"$=":return this._testDollarEqual(a);case"|=":return this._testPipeEqual(a);case"~=":return this._testTildeEqual(a);case"*=":return this._testStarEqual(a)}throw"undefined operation:"+this.op},test:function(a){return this.op&&this.left&&this.right?this._testOp(a):this.left?this._testHasAttr(a):!1}},a}(),u=function(){function a(a){this.name=this._normalize(a)}return a.prototype={hasPseudoElement:function(){return"before"===this.name||"after"===this.name||"first-letter"===this.name||"first-line"===this.name},test:function(a){switch(this.name){case"before":return!0;case"after":return!0;case"first-letter":return!a.isEmpty();case"first-line":return!a.isEmpty();case"first-child":return a.isFirstChild();case"last-child":return a.isLastChild();case"first-of-type":return a.isFirstOfType();case"last-of-type":return a.isLastOfType();case"only-child":return a.isOnlyChild();case"only-of-type":return a.isOnlyOfType();case"empty":return a.isEmpty();case"root":return a.isRoot()}return!1},_normalize:function(a){return a.replace(/:+/g,"")}},a}(),v=function(){function a(a){this.name=a.name,this.id=a.id,this.className=a.className,this.attrs=a.attrs,this.pseudo=a.pseudo}return a.prototype={test:function(a){return null===a?!1:this.name&&"*"!=this.name&&a.getMarkupName()!=this.name?!1:this.className&&!a.hasMarkupClassName(this.className)?!1:this.id&&a.getMarkupId()!=this.id?!1:this.attrs.length>0&&!this._testAttrs(a)?!1:this.pseudo&&!this.pseudo.test(a)?!1:!0},getIdSpec:function(){return this.id?1:0},getClassSpec:function(){return this.className?1:0},getTypeSpec:function(){return"*"!==this.name&&""!==this.name?1:0},getPseudoClassSpec:function(){return this.pseudo?this.pseudo.hasPseudoElement()?0:1:0},getAttrSpec:function(){return this.attrs.length},_testAttrs:function(a){return h.forall(this.attrs,function(b){return b.test(a)})}},a}(),w=function(){function a(a){this.buff=this._normalize(a)}var b=/^[\w-_\.#\*!\?]+/,c=/^\[[^\]]+\]/,d=/^:{1,2}[\w-_]+/;return a.prototype={getTokens:function(){for(var a=[];""!==this.buff;){var b=this._getNextToken();if(null===b)break;a.push(b)}return a},_getNextToken:function(){if(""===this.buff)return null;var a=this.buff.charAt(0);switch(a){case"+":case"~":case">":return this._stepBuff(1),a;default:var b=this._getType();if(b){var c=this._getAttrs(),d=this._getPseudo();return this._parseType(b,c,d)}}throw"invalid selector:"+this.buff},_normalize:function(a){return k.trim(a).replace(/\s+/g," ")},_stepBuff:function(a){this.buff=k.trim(this.buff.slice(a))},_parseType:function(a,b,c){return new v({name:this._getName(a),id:this._getId(a),className:this._getClassName(a),attrs:b,pseudo:c?new u(c):null})},_getByRex:function(a){var b=null,c=this.buff.match(a);return c&&(b=c[0],this._stepBuff(b.length)),b},_getName:function(a){return a.replace(/[\.#].+$/,"")},_getId:function(a){var b=a.split("#");return b.length>0?b[1]:""},_getClassName:function(a){var b=a.split(".");return b.length>=2?b[1]:""},_getType:function(){return this._getByRex(b)},_getAttrs:function(){for(var a=[];;){var b=this._getByRex(c);if(!b)break;a.push(new t(b))}return a},_getPseudo:function(){return this._getByRex(d)}},a}(),x=function(){var a=function(a,b){for(var c=a.parent;null!==c;){if(b.test(c))return c;c=c.parent}return null},b=function(a,b){var c=a.parent;return null===c?null:b.test(c)?c:null},c=function(a,b,c){return h.find(a.getParentChilds(),function(d){var e=d.getNextSibling();return e&&e===a&&b.test(d)&&c.test(e)})},d=function(a,b,c){var d=h.find(a.getParentChilds(),function(a){return b.test(a)});if(null===d)return null;for(var e=d.getNextSibling();null!==e;){if(e===a&&c.test(e))return d;e=e.getNextSibling()}return null};return{accept:function(e,f){if(0===f.length)throw"selector syntax error:"+src;for(var g,h,i,j,k=f.length-1,l=function(){return 0>k?null:f[k--]},m=function(){k++};k>=0;){if(g=l(),g instanceof v==!1)throw"selector syntax error:"+src;if(!g.test(e))return!1;if(h=l(),null===h)return!0;if(h instanceof v)i=h,j=" ";else if("string"==typeof h&&(j=h,i=l(),null===i||i instanceof v==!1))throw"selector syntax error:"+src;switch(j){case" ":e=a(e,i);break;case">":e=b(e,i);break;case"+":e=c(e,i,g);break;case"~":e=d(e,i,g);break;default:throw"selector syntax error:invalid combinator("+j+")"}if(null===e)return!1;m()}return!0}}}(),y=function(){function a(a,b){this.key=this._normalizeKey(a),this.value=this._formatValue(b),this.parts=this._getSelectorParts(this.key),this.spec=this._countSpec(this.parts)}var b=function(a,b,d){d instanceof Array?c(a,d):a[b]=d},c=function(a,c){h.iter(c,function(c){for(var d in c)b(a,d,c[d])})};return a.prototype={getKey:function(){return this.key},getValue:function(){return this.value},setValue:function(a){this.value=a},getSpec:function(){return this.spec},test:function(a,b){return b&&!this.hasPseudoElementName(b)?!1:x.accept(a,this.parts)},hasPseudoElement:function(){return this.key.indexOf("::")>=0},hasPseudoElementName:function(a){return this.key.indexOf("::"+a)>=0},_countSpec:function(a){var b=0,c=0,d=0;return h.iter(a,function(a){a instanceof v&&(b+=a.getIdSpec(),c+=a.getClassSpec()+a.getPseudoClassSpec()+a.getAttrSpec(),d+=a.getTypeSpec())}),parseInt([b,c,d].join(""),10)},_getSelectorParts:function(a){var b=new w(a);return b.getTokens()},_normalizeKey:function(a){return k.trim(a).toLowerCase().replace(/\s+/g," ")},_formatValue:function(a){var c={};for(var d in a)b(c,d,s.format(d,a[d]));return c}},a}(),z=function(){var a=[],b=[],c=function(){a.sort(function(a,b){return a.spec-b.spec})},d=function(){b.sort(function(a,b){return a.spec-b.spec})},e=function(c,d){var e=f[c];r.copy(e,d);var g=h.find(a.concat(b),function(a){return a.getKey()===c});g&&g.setValue(e)},g=function(c,d){var e=new y(c,d);return e.hasPseudoElement()?b.push(e):a.push(e),e},j=function(b){return h.fold(a,{},function(a,c){return c.test(b)?r.copy(a,c.getValue()):a})},k=function(a,c){return h.fold(b,{},function(b,d){return d.test(a,c)?r.copy(b,d.getValue()):b})},l=function(){i.iter(f,function(a,b,c){g(b,c)}),c(),d()};return l(),{setValue:function(a,b){if(f[a])return void e(a,b);g(a,b);var h=g(a,b);f[a]=h.getValue(),h.hasPseudoElement()?d():c()},getValue:function(a){return j(a)},getValuePe:function(a,b){return k(a,b)}}}(),A=function(){var a=function(a,b){for(var c=function(){return a.charAt(0)},d=function(b){a=a.substring(b)},e=function(b){var c=-1;return h.iter(b,function(b){var d=a.indexOf(b,1);(0>c||c>d)&&(c=d)}),(c>=0?a.substring(0,c):a).toLowerCase()},f=function(b){var c=a.indexOf(b,1);return c>=1?a.substring(1,c):a},g=function(g){if(""===a)return void(g&&(b[g]=!0));var h,i=c();if(" "===i)d(1),arguments.callee(g);else if("="===i){if(d(1),a.length>0){var j=c();'"'===j||"'"===j?(h=f(j),d(h.length+2)):(h=e([" "]),d(h.length)),b[g]=h}}else g?b[g]=!0:(g=e([" ","="]),d(g.length),arguments.callee(g))};""!==a;)g();return b},b=function(a){return a.replace(/<[\S]+/,"").replace(/^\s+/,"").replace("/>","").replace(">","").replace(/\s+$/,"").replace(/\n/g,"").replace(/[　|\s]+/g," ").replace(/\s+=/g,"=").replace(/=\s+/g,"=")};return{parse:function(c){return c=b(c),a(c,{})}}}(),B=function(){function a(a,b){this._type="tag",this.src=a,this.content=b||"",this.name=this._parseName(this.src),this.attr=A.parse(this.src),this.id=this._parseId(),this.classes=this._parseClasses(this.attr["class"]||""),this.datasetCamel={},this.datasetRaw={},this._parseDataset(this.datasetCamel,this.datasetRaw)}return a.prototype={clone:function(){return new a(this.src,this.content)},setContent:function(a){this.content=a},addClass:function(a){this.classes.push(a)},removeClass:function(a){this.classes=h.filter(this.classes,function(b){return b!=a})},getName:function(){return this.name},getCssClasses:function(){return this.classes.join(" ")},getAttr:function(a,b){var c=this.attr[a];return"undefined"!=typeof c?c:"undefined"!=typeof b?b:null},getDataset:function(a,b){var c=this.datasetCamel[a];return"undefined"!=typeof c?c:"undefined"!=typeof b?b:null},getDatasetAttr:function(){return this.datasetRaw},getContent:function(){return this.content},getSrc:function(){return this.src},getWrapSrc:function(){return""===this.content?this.src:this.src+this.content+"</"+this.name+">"},hasClass:function(a){return h.exists(this.classes,q.eq(a))},hasAttr:function(){return"undefined"!=typeof this.attr.name},isAnchorTag:function(){return"a"===this.name&&null!==this.getTagAttr("name")},isAnchorLinkTag:function(){var a=this.getTagAttr("href");return"a"===this.name&&a&&a.indexOf("#")>=0},isEmpty:function(){return""===this.content},_parseName:function(a){return a.replace(/</g,"").replace(/\/?>/g,"").split(/\s/)[0].toLowerCase()},_parseId:function(){var a=this.attr.id||"";return""===a?a:0===this.attr.id.indexOf("nehan-")?"nehan-"+a:a},_parseClasses:function(a){a=k.trim(a.replace(/\s+/g," "));var b=""===a?[]:a.split(/\s+/);return h.map(b,function(a){return 0===a.indexOf("nehan-")?a:"nehan-"+a})},_parseCssClasses:function(a){return h.map(a,function(a){return"."+a})},_parseDataset:function(a,b){for(var c in this.attr)if(0===c.indexOf("data-")){var d=this._parseDatasetName(c),e=this.attr[c];a[d]=e,b[c]=e}},_parseDatasetName:function(a){var b=a.slice(5);return k.getCamelName(b)}},a}(),C={isTag:function(a){return"tag"===a._type},isText:function(a){return"char"===a._type||"word"===a._type||"tcy"===a._type||"ruby"===a._type},isChar:function(a){return"char"===a._type},isWord:function(a){return"word"===a._type},isTcy:function(a){return"tcy"===a._type},isNewLine:function(a){return a instanceof D&&a.isNewLineChar()},isWhiteSpace:function(a){return a instanceof D&&a.isWhiteSpaceChar()}},D=function(){function a(a,b){this.data=a,this._type="char",this.isRef=b||!1,this.isRef||this._setup(a.charCodeAt(0))}var b=["。","."],f=["、",","],g=["｢","「","『","【","［","（","《","〈","≪","＜","｛","{","[","("],i=["」","｣","』","】","］","）","》","〉","≫","＞","｝","}","]",")"],j=["ぁ","ぃ","ぅ","ぇ","ぉ","っ","ゃ","ゅ","ょ","ゎ","ァ","ィ","ゥ","ェ","ォ","ヵ","ヶ","ッ","ャ","ュ","ョ","ヮ"],k=["）","\\",")","」","】","〕","］","\\","]","。","』","＞","〉","》","、","．","\\",".",",","”","〟"],l=["（","\\","(","「","【","［","〔","\\","[","『","＜","〈","《","“","〝"];return a.prototype={getCssPadding:function(a){var b=new hb;return this.paddingStart&&b.setStart(a.style.flow,this.paddingStart),this.paddingEnd&&b.setEnd(a.style.flow,this.paddingEnd),b.getCss()},getCssVertGlyph:function(){var a={},b=this.isPaddingEnable();return a["margin-left"]="auto",a["margin-right"]="auto",this.isKakkoStart()?b||(a["margin-top"]="-0.5em"):(this.getVertScale()<1&&(a.height="0.5em"),b&&(a["margin-bottom"]="0.5em")),a
},getCssVertImgChar:function(a){var b={},c=a.style.getFontSize();return b.display="block",b.width=c+"px",b.height=this.getVertHeight(c)+"px",b["margin-left"]="auto",b["margin-right"]="auto",this.isPaddingEnable()&&r.copy(b,this.getCssPadding(a)),b},getCssVertRotateCharIE:function(a){var b={},c=a.style.getFontSize();return b["float"]="left",b["writing-mode"]="tb-rl",b["padding-left"]=Math.round(c/2)+"px",b["line-height"]=c+"px",b},getCssVertEmphaTarget:function(){var a={};return a},getCssVertEmphaText:function(a){var b={},c=a.style.getFontSize();return b.display="inline-block",b.width=c+"px",b.height=c+"px",b},getCssHoriEmphaTarget:function(){var a={};return a},getCssHoriEmphaText:function(){var a={};return a},getCssVertLetterSpacing:function(a){var b={};return b["margin-bottom"]=a.letterSpacing+"px",b},getCssVertHalfSpaceChar:function(a){var b={},c=a.style.getFontSize(),d=Math.round(c/2);return b.height=d+"px",b["line-height"]=d+"px",b},getCssVertSmallKana:function(){var a={};return a.position="relative",a.top="-0.1em",a.right="-0.12em",a.height=this.bodySize+"px",a["line-height"]=this.bodySize+"px",a.clear="both",a},getHoriScale:function(){return this.hscale?this.hscale:1},getVertScale:function(){return this.vscale?this.vscale:1},getVertHeight:function(a){var b=this.getVertScale();return 1===b?a:Math.round(a*b)},hasMetrics:function(){return"undefined"!=typeof this.bodySize},getAdvance:function(a,b){return this.bodySize+this.getPaddingSize()+(b||0)},getPaddingSize:function(){return(this.paddingStart||0)+(this.paddingEnd||0)},getCharCount:function(){return" "===this.data||"	"===this.data||"　"===this.data?0:1},setMetrics:function(a,b){var c=a.isTextVertical(),d=c?this.getVertScale():this.getHoriScale();this.bodySize=1!=d?Math.round(b.size*d):b.size,this.spaceRateStart&&(this.paddingStart=Math.round(this.spaceRateStart*b.size)),this.spaceRateEnd&&(this.paddingEnd=Math.round(this.spaceRateEnd*b.size)),this.img&&"tenten"===this.img&&(this.bodySize=b.size),c||this.isRef||!this.isHankaku()||(this.bodySize=Math.round(b.size/2))},_setImg:function(a,b,c){this.img=a,this.vscale=b||1,this.hscale=c||this.vscale},_setCnv:function(a,b,c){this.cnv=a,this.vscale=b||1,this.hscale=c||this.vscale},_setRotate:function(a){this.rotate=a},_setup:function(a){switch(a){case 32:this._setCnv("&nbsp;",.5,.5);break;case 12300:this._setImg("kakko1",.5);break;case 65378:this._setImg("kakko1",.5);break;case 12301:this._setImg("kakko2",.5);break;case 65379:this._setImg("kakko2",.5);break;case 12302:this._setImg("kakko3",.5);break;case 12303:this._setImg("kakko4",.5);break;case 65288:this._setImg("kakko5",.5);break;case 40:this._setImg("kakko5",.5);break;case 65371:this._setImg("kakko5",.5);break;case 123:this._setImg("kakko5",.5);break;case 65289:this._setImg("kakko6",.5);break;case 41:this._setImg("kakko6",.5);break;case 65373:this._setImg("kakko6",.5);break;case 125:this._setImg("kakko6",.5);break;case 65308:this._setImg("kakko7",.5);break;case 60:this._setImg("kakko7",.5);break;case 12296:this._setImg("kakko7",.5);break;case 65310:this._setImg("kakko8",.5);break;case 62:this._setImg("kakko8",.5);break;case 12297:this._setImg("kakko8",.5);break;case 12298:this._setImg("kakko9",.5);break;case 8810:this._setImg("kakko9",.5);break;case 12299:this._setImg("kakko10",.5);break;case 8811:this._setImg("kakko10",.5);break;case 65339:this._setImg("kakko11",.5);break;case 12308:this._setImg("kakko11",.5);break;case 91:this._setImg("kakko11",.5);break;case 65341:this._setImg("kakko12",.5);break;case 12309:this._setImg("kakko12",.5);break;case 93:this._setImg("kakko12",.5);break;case 12304:this._setImg("kakko17",.5);break;case 12305:this._setImg("kakko18",.5);break;case 65306:this._setImg("tenten",.5,1);break;case 58:this._setImg("tenten",.5,1);break;case 12290:this._setImg("kuten",.5);break;case 65377:this._setImg("kuten",.5);break;case 65294:this._setImg("period",1);break;case 46:this._setImg("period",1);break;case 12289:this._setImg("touten",.5);break;case 65380:this._setImg("touten",.5);break;case 44:this._setImg("touten",.5);break;case 65292:this._setImg("touten",.5);break;case 65374:this._setImg("kara",1);break;case 12316:this._setImg("kara",1);break;case 8230:this._setImg("mmm",1);break;case 8229:this._setImg("mm",1);break;case 12317:this._setImg("dmn1",1);break;case 12319:this._setImg("dmn2",1);break;case 65309:this._setImg("equal",1);break;case 61:this._setImg("equal",1);break;case 12540:this._setImg("onbiki",1);break;case 45:this._setCnv("&#65372;");break;case 8213:this._setCnv("&#65372;");break;case 65293:this._setCnv("&#65372;");break;case 9472:this._setCnv("&#65372;");break;case 8593:this._setCnv("&#8594;");break;case 8594:this._setCnv("&#8595;");break;case 8658:this._setCnv("&#8595;");break;case 8595:this._setCnv("&#8592;");break;case 8592:this._setCnv("&#8593;");break;case 8220:this._setRotate(90);break;case 8221:this._setRotate(90)}},isNewLineChar:function(){return"\n"===this.data},isSpaceChar:function(){return" "===this.data||"&nbsp;"===this.data||"　"===this.data||"	"===this.data},isWhiteSpaceChar:function(){return this.isNewLineChar()||this.isSpaceChar()},isImgChar:function(){return"undefined"!=typeof this.img},isCnvChar:function(){return"undefined"!=typeof this.cnv},isRotateChar:function(){return"undefined"!=typeof this.rotate},isCharRef:function(){return this.isRef},isHalfSpaceChar:function(){return this.isCnvChar()&&"&nbsp;"===this.cnv},isKerningChar:function(){return this.isKutenTouten()||this.isKakko()},getImgSrc:function(a){return[d.fontImgRoot,this.img,a+".png"].join("/")},isPaddingEnable:function(){return"undefined"!=typeof this.paddingStart||"undefined"!=typeof this.paddingEnd},isVertGlyphEnable:function(){return!this.isTenten()&&c.useVerticalGlyphIfEnable&&e.isVerticalGlyphEnable},isTenten:function(){return this.img&&"tenten"===this.img},isHeadNg:function(){return h.mem(k,this.data)},isTailNg:function(){return h.mem(l,this.data)},isSmallKana:function(){return h.mem(j,this.data)},isKakkoStart:function(){return h.mem(g,this.data)},isKakkoEnd:function(){return h.mem(i,this.data)},isKakko:function(){return this.isKakkoStart()||this.isKakkoEnd()},isKuten:function(){return h.mem(b,this.data)},isTouten:function(){return h.mem(f,this.data)},isKutenTouten:function(){return this.isKuten()||this.isTouten()},isZenkaku:function(){return"u"===escape(this.data).charAt(1)},isHankaku:function(){return!this.isZenkaku(this.data)}},a}(),E=function(){function a(a,b){this.data=a,this._type="word",this._devided=b||!1}return a.prototype={getCssVertTrans:function(a){var b={};return a.style.letterSpacing&&(b["letter-spacing"]=a.style.letterSpacing+"px"),b.width=a.style.getFontSize()+"px",b.height=this.bodySize+"px",b["margin-left"]="auto",b["margin-right"]="auto",b},getCssVertTransBody:function(a){var b={};return b["font-family"]=a.style.getFontFamily(),b},getCssVertTransBodyTrident:function(a){var b={};b["font-family"]=a.style.getFontFamily(),b.width=a.style.getFontSize()+"px",b.height=this.bodySize+"px",b["transform-origin"]="50% 50%",b["line-height"]=this.bodySize+"px";var c=Math.floor((this.bodySize-a.style.getFontSize())/2);return c>0&&(b.transform="rotate(90deg) translate(-"+c+"px, 0)"),b},getCssVertTransIE:function(a){var b={},c=a.style.getFontSize();return b["float"]="left",b["writing-mode"]="tb-rl",b["letter-spacing"]=(a.style.letterSpacing||0)+"px",b["padding-left"]=Math.round(c/2)+"px",b["line-height"]=c+"px",b},getCharCount:function(){return 1},getAdvance:function(a,b){return this.bodySize+(b||0)*this.getLetterCount()},hasMetrics:function(){return"undefined"!=typeof this.bodySize},countUpper:function(){for(var a=0,b=0;b<this.data.length;b++)/[A-Z]/.test(this.data.charAt(b))&&a++;return a},setMetrics:function(a,b){return c.useStrictWordMetrics&&M.isEnable()?void(this.bodySize=M.getMeasure(b,this.data)):(this.bodySize=Math.round(this.data.length*b.size*.5),void(b.isBold()&&(this.bodySize+=Math.round(d.boldRate*this.bodySize))))},getLetterCount:function(){return this.data.length},setDevided:function(a){this._devided=a},isDevided:function(){return this._devided},cutMeasure:function(b,c){var d=Math.round(b/2),e=Math.round(this.bodySize/d),f=Math.round(c/d);if(f>e)return this;var g=this.data.substring(0,f),h=new a(g,!0);return this.data=this.data.slice(f),this.setDevided(!0),h}},a}(),F=function(){function a(a){this.data=a,this._type="tcy"}return a.prototype={getCharCount:function(){return 1},getAdvance:function(a,b){return this.bodySize+b},hasMetrics:function(){return"undefined"!=typeof this.bodySize},setMetrics:function(a,b){this.bodySize=b.size}},a}(),G=function(){function a(a,b){this._type="ruby",this.rbs=a,this.rt=b}return a.prototype={hasMetrics:function(){return"undefined"!=typeof this.advanceSize},getCharCount:function(){return this.rbs?this.rbs.length:0},getAdvance:function(){return this.advanceSize},getRbs:function(){return this.rbs},getRtString:function(){return this.rt?this.rt.getContent():""},getRtFontSize:function(){return this.rtFontSize},getCssHoriRuby:function(){var a={};return a.display="inline-block",a},getCssVertRt:function(){var a={};return a["float"]="left",a},getCssHoriRt:function(a){{var b={};Math.floor((a.style.getFontSize()-this.getRtFontSize())/3)}return b["font-size"]=this.getRtFontSize()+"px",b["line-height"]="1em",b},getCssVertRb:function(){var a={};return a["float"]="left",this.padding&&r.copy(a,this.padding.getCss()),a},getCssHoriRb:function(){var a={};return this.padding&&r.copy(a,this.padding.getCss()),a["text-align"]="center",a},setMetrics:function(a,b,c){this.rtFontSize=d.getRtFontSize(b.size);var e=h.fold(this.rbs,0,function(d,e){return e.setMetrics(a,b),d+e.getAdvance(a,c)}),f=this.rtFontSize*this.getRtString().length;if(this.advanceSize=e,f>e){var g=Math.ceil((f-e)/2);this.rbs.length>0&&(this.padding=new hb,this.padding.setStart(a,g),this.padding.setEnd(a,g)),this.advanceSize+=g+g}}},a}(),H=function(){function a(a){this.value=String(a),this.red=parseInt(this.value.substring(0,2),16),this.green=parseInt(this.value.substring(2,4),16),this.blue=parseInt(this.value.substring(4,6),16)}return a.prototype={getRed:function(){return this.red},getGreen:function(){return this.green},getBlue:function(){return this.blue},getColorValue:function(){return this.value}},a}(),I=function(){function a(a){this.setValue(a)}return a.prototype={setValue:function(a){this.value=J.get(a)},getValue:function(){return this.value},getCssValue:function(){return"transparent"===this.value?this.value:"#"+this.value},getRgb:function(){return new H(this.value)},getCss:function(){var a={};return a.color=this.getCssValue(),a}},a}(),J=function(){var a={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4","indianred ":"cd5c5c","indigo ":"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32",transparent:"transparent"},b=/^(?:[0-9a-f]{3}){1,2}$/;return{get:function(c){return c=c.replace(/#/g,"").toLowerCase(),b.test(c)?3===c.length?c[0]+c[0]+c[1]+c[1]+c[2]+c[2]:c:a[c]||c}}}(),K=function(){var a=[0,36,73,109,146,182,219,255],b=[0,85,170,255],c=function(a){var b=a.toString(16);return b.length<=1?"0"+b:b},d=function(a,b){return h.exists(b,q.eq(a))?a:h.minobj(b,function(b){return Math.abs(b-a)})};return{getColor:function(e){var f=d(e.getRed(),a),g=d(e.getGreen(),a),h=d(e.getBlue(),b);return[c(f),c(g),c(h)].join("")}}}(),L=function(){var a={"lower-alpha":["a","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],"upper-alpha":["A","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],"lower-roman":["i","i","ii","iii","iv","v","vi","vii","viii","ix","x","xi","xii","xiii","xiv","xv","xvi","xvii","xviii","xix","xx"],"upper-roman":["I","I","II","III","IV","V","VI","VII","VIII","IX","X","XI","XII","XIII","XIV","XV","XVI","XVII","XVIII","XIX","XX"],"lower-greek":["α","α","β","γ","δ","ε","ζ","η","θ","ι","κ","λ","μ","ν","ξ","ο","π","ρ","σ","τ","υ","φ","χ","ψ","ω"],"upper-greek":["Α","Α","Β","Γ","Δ","Ε","Ζ","Η","Θ","Ι","Κ","Λ","Μ","Ν","Ξ","Ο","Π","Ρ","Σ","Τ","Υ","Φ","Χ","Ψ","Ω"],"cjk-ideographic":["〇","一","二","三","四","五","六","七","八","九","十"],hiragana:["あ","あ","い","う","え","お","か","き","く","け","こ","さ","し","す","せ","そ","た","ち","つ","て","と","な","に","ぬ","ね","の","は","ひ","ふ","へ","ほ","ま","み","む","め","も","や","ゆ","よ","ら","り","る","れ","ろ","わ","ゐ","ゑ","を","ん"],"hiragana-iroha":["い","い","ろ","は","に","ほ","へ","と","ち","り","ぬ","る","を","わ","か","よ","た","れ","そ","つ","ね","な","ら","む","う","ゐ","の","お","く","や","ま","け","ふ","こ","え","て","あ","さ","き","ゆ","め","み","し","ゑ","ひ","も","せ","す"],katakana:["ア","ア","イ","ウ","エ","オ","カ","キ","ク","ケ","コ","サ","シ","ス","セ","ソ","タ","チ","ツ","テ","ト","ナ","ニ","ヌ","ネ","ノ","ハ","ヒ","フ","ヘ","ホ","マ","ミ","ム","メ","モ","ヤ","ユ","ヨ","ラ","リ","ル","レ","ロ","ワ","ヰ","ヱ","ヲ","ン"],"katakana-iroha":["イ","イ","ロ","ハ","ニ","ホ","ヘ","ト","チ","リ","ヌ","ル","ヲ","ワ","カ","ヨ","タ","レ","ソ","ツ","ネ","ナ","ラ","ム","ウ","ヰ","ノ","オ","ク","ヤ","マ","ケ","フ","コ","エ","テ","ア","サ","キ","ユ","メ","ミ","シ","ヱ","ヒ","モ","セ","ス"]},b={"upper-latin":"upper-alpha","lower-latin":"lower-alpha"};return{getTableByName:function(c){return a[b[c]||c]},getBaseByName:function(a){var b=this.getTableByName(a);return b.length},getStringByName:function(a,b){for(var c=this.getTableByName(a),d=c.length,e=l.convBase(b,d),f="",g=0;g<e.length;g++){var h=e[g],i=0===g?e[g]:Math.min(h+1,d-1);f+=c[i]||""}return f}}}(),M=function(){var a=document.createElement("canvas");a.style.width=Math.max(d.width,d.height)+"px",a.style.height=d.maxFontSize+"px";var b;return a.getContext&&(b=a.getContext("2d"),b.textAlign="left"),{isEnable:function(){return b&&"undefined"!=typeof b.measureText},getMetrics:function(a,c){return b.font=a.toString(),b.measureText(c)},getMeasure:function(a,b){var c=this.getMetrics(a,b);return c.width}}}(),N=function(){function a(a){this.type=a}var b={disc:"&#x2022;",circle:"&#x25CB;",square:"&#x25A0;"};return a.prototype={isDecimalList:function(){return"decimal"===this.type||"decimal-leading-zero"===this.type},isNoneList:function(){return"none"===this.type},isMarkList:function(){return"disc"===this.type||"circle"===this.type||"square"===this.type},isCountableList:function(){return!this.isNoneList()&&!this.isMarkList()},isHankaku:function(){return"lower-alpha"===this.type||"upper-alpha"===this.type||"lower-roman"===this.type||"upper-roman"===this.type||this.isDecimalList()},isZenkaku:function(){return!this.isHankaku()},_getMarkerDigitString:function(a){return"decimal"===this.type?a.toString(10):"decimal-leading-zero"===this.type?10>a?"0"+a.toString(10):a.toString(10):L.getStringByName(this.type,a)},getMarkerHtml:function(a){var b=this.getMarkerText(a);return this.isZenkaku()?p.tagWrap("span",b,{"class":"nehan-tcy"}):b},getMarkerText:function(a){if(this.isNoneList())return n.space;if(this.isMarkList())return b[this.type]||"";var c=this._getMarkerDigitString(a);return c+"."}},a}(),O=function(){function a(a){this.pos=a}return a.prototype={isOutside:function(){return"outside"===this.pos},isInside:function(){return"inside"===this.pos}},a}(),P=function(){function a(a){this.image=a}return a.prototype={getMarkerHtml:function(){var a=this.image.url,b=this.image.width||d.fontSize,c=this.image.height||d.fontSize;return p.tagSingle("img",{src:a,"class":"nehan-list-image",width:b,height:c})}},a}(),Q=function(){function a(a){this.type=new N(a.type||"none"),this.position=new O(a.position||"outside"),this.image="none"!==a.image?new P(a.image):null,this.format=a.format||null}return a.prototype={isMultiCol:function(){return this.position.isOutside()},isInside:function(){return this.position.isInside()},isImageList:function(){return null!==this.image},getMarkerHtml:function(a){return null!==this.format?"function"==typeof this.format?this.format(a):this.format:null!==this.image?this.image.getMarkerHtml(a):this.type.getMarkerHtml(a)}},a}(),R=function(){function a(a){this.dir=a}return a.prototype={init:function(a){this.dir=a},isHorizontal:function(){return"lr"===this.dir||"rl"===this.dir},isVertical:function(){return"tb"===this.dir},isLeftToRight:function(){return"lr"===this.dir},isRightToLeft:function(){return"rl"===this.dir}},a}(),S=function(){function a(a,b){R.call(this,a),this.multicol=b||!1}return g.extend(a,R),a.prototype.flip=function(){switch(this.dir){case"lr":case"rl":return"tb";case"tb":return d.getVertBlockdir();default:return""}},a.prototype.getCss=function(){var a={};return this.isHorizontal()?a["float"]="lr"===this.dir?"left":"right":this.isVertical()&&this.multicol&&(a["float"]="lr"===d.getHoriIndir()?"left":"right"),a},a.prototype.getPropBefore=function(){switch(this.dir){case"lr":return"left";case"rl":return"right";case"tb":return"top";default:return""}},a.prototype.getPropAfter=function(){switch(this.dir){case"lr":return"right";case"rl":return"left";case"tb":return"bottom";default:return""}},a}(),T=function(){function a(a){R.call(this,a)}return g.extend(a,R),a.prototype.getPropStart=function(){switch(this.dir){case"lr":return"left";case"rl":return"right";case"tb":return"top";default:return""}},a.prototype.getPropEnd=function(){switch(this.dir){case"lr":return"right";case"rl":return"left";case"tb":return"bottom";default:return""}},a}(),U=function(){function a(a,b){this.pos=a||"center",this.offset=b||0}return a.prototype={getCssValue:function(a){var b=[a.getProp(this.pos)];return this.offset&&b.push(this.offset),b.join(" ")}},a}(),V=function(){function a(a,b){this.inline=a,this.block=b}return a.prototype={getCssValue:function(a){return[this.inline.getCssValue(a),this.block.getCssValue(a)].join(" ")},getCss:function(a){var b={};return b["background-pos"]=this.getCssValue(a),b}},a}(),W=function(){function a(a){this.value=a}return a.prototype={isSingleValue:function(){return"repeat-x"===this.value||"repeat-y"===this.value||"repeat-inline"===this.value||"repeat-block"===this.value},getCssValue:function(a){var b=a.isTextVertical();switch(this.value){case"repeat-inline":case"repeat-x":return b?"repeat-y":"repeat-x";case"repeat-block":case"repeat-y":return b?"repeat-x":"repeat-y";default:return this.value}}},a}(),X=function(){function a(a,b){this.inline=a,this.block=b}return a.prototype={_getRepeatValue:function(a,b){var c=a.isTextVertical();switch(b){case"repeat-inline":case"repeat-x":return c?"repeat-y":"repeat-x";case"repeat-block":case"repeat-y":return c?"repeat-x":"repeat-y";default:return b}},getCssValue:function(a){var b=[this.inline];return this.inline.isSingleValue()||b.push(this.block),h.map(b,function(b){return b.getCssValue(a)}).join(" ")}},a}(),Y=function(){function a(){}return a.prototype={getCss:function(a){var b={};return this.pos&&r.copy(b,this.pos.getCss(a)),this.repeat&&(b["background-repeat"]=this.repeat.getCssValue(a)),this.origin&&(b["background-origin"]=this.origin),this.color&&(b["background-color"]=this.color.getCssValue()),this.image&&(b["background-image"]=this.image),this.attachment&&(b["background-attachment"]=this.attachment),b}},a}(),Z=function(){function a(a,b,c){this.inflow=new T(a),this.blockflow=new S(b,c)}return a.prototype={isTextLineFirst:function(){return this.isTextVertical()&&this.blockflow.isLeftToRight()?!0:!1},isBlockflowVertical:function(){return this.blockflow.isVertical()},isTextVertical:function(){return this.inflow.isVertical()},isTextHorizontal:function(){return this.inflow.isHorizontal()},getCss:function(){var a={};return r.copy(a,this.blockflow.getCss()),a},getName:function(){return[this.inflow.dir,this.blockflow.dir].join("-")},getTextHorizontalDir:function(){return this.isTextHorizontal()?this.inflow.dir:""},getProp:function(a){switch(a){case"start":return this.getPropStart();case"end":return this.getPropEnd();case"before":return this.getPropBefore();case"after":return this.getPropAfter()}},getPropStart:function(){return this.inflow.getPropStart()},getPropEnd:function(){return this.inflow.getPropEnd()},getPropBefore:function(){return this.blockflow.getPropBefore()},getPropAfter:function(){return this.blockflow.getPropAfter()},getPropExtent:function(){return this.isTextVertical()?"width":"height"},getPropMeasure:function(){return this.isTextVertical()?"height":"width"},getPropWidth:function(){return this.isTextVertical()?"extent":"measure"},getPropHeight:function(){return this.isTextVertical()?"measure":"extent"},getFlipFlow:function(){return this.isTextVertical()?d.getStdHoriFlow():d.getStdVertFlow()},getBoxSize:function(a,b){var c=new pb(0,0);return c[this.getPropMeasure()]=a,c[this.getPropExtent()]=b,c}},a}(),$={"tb-rl":new Z("tb","rl"),"tb-lr":new Z("tb","lr"),"lr-tb":new Z("lr","tb"),"rl-tb":new Z("rl","tb"),"tb-rl-mc":new Z("tb","rl",!0),"tb-lr-mc":new Z("tb","lr",!0),"lr-tb-mc":new Z("lr","tb",!0),"rl-tb-mc":new Z("rl","tb",!0),NORMAL:new Z("lr","tb"),get:function(a,b,c){var d=c||!1,e=a+"-"+b+(d?"-mc":"");return this.getByName(e)},getByName:function(a){if("undefined"==typeof this[a])throw"undefined box-flow"+a;return this[a]}},_={iter:function(a,b){h.iter(n.cssBoxDirs,function(c){a[c]&&b(c,a[c])})},map:function(a,b){return a instanceof Array?h.map(a,b):"object"==typeof a?i.map(a,b):b(a)},setValue:function(a,b,c){return"undefined"!=typeof c.start&&this.setStart(a,b,c.start),"undefined"!=typeof c.end&&this.setEnd(a,b,c.end),"undefined"!=typeof c.before&&this.setBefore(a,b,c.before),"undefined"!=typeof c.after&&this.setAfter(a,b,c.after),a},setBefore:function(a,b,c){a[b.getPropBefore()]=c},setAfter:function(a,b,c){a[b.getPropAfter()]=c},setStart:function(a,b,c){a[b.getPropStart()]=c},setEnd:function(a,b,c){a[b.getPropEnd()]=c}},ab={sortCornerDirection:function(a,b){var c={top:0,bottom:1,left:2,right:3};return[a,b].sort(function(a,b){return c[a]-c[b]})},getCornerName:function(a,b){var c=this.sortCornerDirection(a,b);return[c[0],k.capitalize(c[1])].join("")}},bb=function(){function a(a){this.size=a}return a.prototype={isBold:function(){return this.weight&&"normal"!==this.weight&&"lighter"!==this.weight},toString:function(){return[this.weight||"normal",this.style||"normal",this.size+"px",this.family||"monospace"].join(" ")},getCss:function(){var a={};return this.size&&(a["font-size"]=this.size+"px"),this.weight&&(a["font-weight"]=this.weight),this.style&&(a["font-style"]=this.style),this.family&&(a["font-family"]=this.family),a}},a}(),cb=function(){function a(a){this._type=a,this.top=0,this.right=0,this.bottom=0,this.left=0}return a.prototype={clear:function(){this.top=0,this.right=0,this.bottom=0,this.left=0},clone:function(){var b=new a(this._type);return b.top=this.top,b.right=this.right,b.bottom=this.bottom,b.left=this.left,b},getDirProp:function(a){return[this._type,a].join("-")},getCss:function(){var a={},b=this;return h.iter(["top","right","bottom","left"],function(c){var d=b[c];d>0&&(a[b.getDirProp(c)]=b[c]+"px")}),a},getWidth:function(){return this.left+this.right},getHeight:function(){return this.top+this.bottom},getMeasureSize:function(a){return a.isTextVertical()?this.getHeight():this.getWidth()},getExtentSize:function(a){return a.isBlockflowVertical()?this.getHeight():this.getWidth()},setSize:function(a,b){_.setValue(this,a,b)},setStart:function(a,b){this[a.getPropStart()]=b},setEnd:function(a,b){this[a.getPropEnd()]=b},setBefore:function(a,b){this[a.getPropBefore()]=b},setAfter:function(a,b){this[a.getPropAfter()]=b},getStart:function(a){return this[a.getPropStart()]},getEnd:function(a){return this[a.getPropEnd()]},getBefore:function(a){return this[a.getPropBefore()]},getAfter:function(a){return this[a.getPropAfter()]}},a}(),db=function(){function a(){this.hori=0,this.vert=0}return a.prototype={setSize:function(a){this.hori=a[0],this.vert=a[1]},getCssValueHori:function(){return this.hori+"px"},getCssValueVert:function(){return this.vert+"px"}},a}(),eb=function(){function a(){this.topLeft=new db,this.topRight=new db,this.bottomRight=new db,this.bottomLeft=new db}return a.prototype={getArray:function(){return[this.topLeft,this.topRight,this.bottomRight,this.bottomLeft]},getCssValueHori:function(){return h.map(this.getArray(),function(a){return a.getCssValueHori()}).join(" ")},getCssValueVert:function(){return h.map(this.getArray(),function(a){return a.getCssValueVert()}).join(" ")},getCssValue:function(){return[this.getCssValueHori(),this.getCssValueVert()].join("/")},getCss:function(){var a={},b=this.getCssValue();return a["border-radius"]=b,h.iter(n.cssVenderPrefixes,function(c){var d=[c,"border-radius"].join("-");a[d]=b}),a},getCorner:function(a,b){var c=ab.getCornerName(a,b);return this[c]},setSize:function(a,b){"undefined"!=typeof b["start-before"]&&this.setStartBefore(a,b["start-before"]),"undefined"!=typeof b["start-after"]&&this.setStartAfter(a,b["start-after"]),"undefined"!=typeof b["end-before"]&&this.setEndBefore(a,b["end-before"]),"undefined"!=typeof b["end-after"]&&this.setEndAfter(a,b["end-after"])},setStartBefore:function(a,b){var c=this.getCorner(a.getPropStart(),a.getPropBefore());c.setSize(b)},setStartAfter:function(a,b){var c=this.getCorner(a.getPropStart(),a.getPropAfter());c.setSize(b)},setEndBefore:function(a,b){var c=this.getCorner(a.getPropEnd(),a.getPropBefore());c.setSize(b)},setEndAfter:function(a,b){var c=this.getCorner(a.getPropEnd(),a.getPropAfter());c.setSize(b)},clearBefore:function(a){this.setStartBefore(a,[0,0]),this.setEndBefore(a,[0,0])},clearAfter:function(a){this.setStartAfter(a,[0,0]),this.setEndAfter(a,[0,0])}},a}(),fb=function(){function a(){}return a.prototype={setColor:function(a,b){var c=this;_.setValue(this,a,b),_.iter(this,function(a,b){c[a]=new I(b)})},getCss:function(){var a={};return _.iter(this,function(b,c){var d=["border",b,"color"].join("-");a[d]=c.getCssValue()}),a}},a}(),gb=function(){function a(){}return a.prototype={setStyle:function(a,b){_.setValue(this,a,b)},getCss:function(){var a={};return _.iter(this,function(b,c){var d=["border",b,"style"].join("-");a[d]=c}),a}},a}(),hb=function(){function a(){cb.call(this,"padding")}return g.extend(a,cb),a}(),ib=function(){function a(){cb.call(this,"margin")}return g.extend(a,cb),a}(),jb=function(){function a(){cb.call(this,"border")}return g.extend(a,cb),a.prototype.clearBefore=function(a){this.setBefore(a,0),this.radius&&this.radius.clearBefore(a)},a.prototype.clearAfter=function(a){this.setAfter(a,0),this.radius&&this.radius.clearAfter(a)},a.prototype.getDirProp=function(a){return["border",a,"width"].join("-")},a.prototype.setRadius=function(a,b){this.radius=new eb,this.radius.setSize(a,b)},a.prototype.setColor=function(a,b){this.color=new fb,this.color.setColor(a,b)},a.prototype.setStyle=function(a,b){this.style=new gb,this.style.setStyle(a,b)},a.prototype.getCss=function(){var a=cb.prototype.getCss.call(this);return this.radius&&r.copy(a,this.radius.getCss()),this.color&&r.copy(a,this.color.getCss()),this.style&&r.copy(a,this.style.getCss()),a},a}(),kb=function(){function a(a){this.value=a||"none"}var b="filled dot",c={"filled dot":"&#x2022;","open dot":"&#x25e6;","filled circle":"&#x25cf;","open circle":"&#x25cb;","filled double-circle":"&#x25c9;","open double-circle":"&#x25ce;","filled triangle":"&#x25b2;","open triangle":"&#x25b3;","filled sesame":"&#xfe45;","open sesame":"&#xfe46;"};return a.prototype={isEnable:function(){return"none"!=this.value},setValue:function(a){this.value=a},getText:function(){return c[this.value]||this.value||c[b]},getCss:function(){var a={};return a}},a}(),lb=function(){function a(a){r.merge(this,{hori:"over",vert:"right"},a||{})}return a.prototype={isEmphaFirst:function(){return"over"===this.hori||"left"===this.vert},getCss:function(){var a={};return a}},a}(),mb=function(){function a(a){a=a||{},this.style=a.style||new kb,this.pos=a.pos||new lb,this.color=a.color||new I(d.fontColor)}return a.prototype={isEnable:function(){return this.style&&this.style.isEnable()},isEmphaStart:function(){return this.pos?this.pos.isEmphaStart():!0},getText:function(){return this.style?this.style.getText():""},getExtent:function(a){return 3*a},getCssVertEmphaWrap:function(a,b){var c={},d=a.style.getFontSize();return c["text-align"]="left",c.width=this.getExtent(d)+"px",c.height=b.getAdvance(a.style.flow,a.style.letterSpacing||0)+"px",c},getCssHoriEmphaWrap:function(a,b){var c={},d=a.style.getFontSize();return c.display="inline-block",c.width=b.getAdvance(a.style.flow,a.style.letterSpacing)+"px",c.height=this.getExtent(d)+"px",c}},a}(),nb=function(){function a(a){this.address=this._normalize(a||"")}return a.prototype={_normalize:function(a){return a.replace(/\s/g,"")},getAddress:function(){return this.address},getAnchorName:function(){var a=this.address.indexOf("#");return 0>a?"":this.address.substring(a+1)}},a}(),ob=function(){function a(){this.padding=new hb,this.border=new jb,this.margin=new ib}return a.prototype={clone:function(){var b=new a;return b.padding=this.padding.clone(),b.border=this.border.clone(),b.margin=this.margin.clone(),b},clear:function(){this.padding.clear(),this.border.clear(),this.margin.clear()},getCss:function(){var a={};return r.copy(a,this.padding.getCss()),r.copy(a,this.border.getCss()),r.copy(a,this.margin.getCss()),a},getWidth:function(){var a=0;return a+=this.padding.getWidth(),a+=this.border.getWidth(),a+=this.margin.getWidth()},getHeight:function(){var a=0;return a+=this.padding.getHeight(),a+=this.border.getHeight(),a+=this.margin.getHeight()},getMeasureSize:function(a){var b=0;return b+=this.padding.getMeasureSize(a),b+=this.border.getMeasureSize(a),b+=this.margin.getMeasureSize(a)},getExtentSize:function(a){var b=0;return b+=this.padding.getExtentSize(a),b+=this.margin.getExtentSize(a),b+=this.border.getExtentSize(a)},getInnerMeasureSize:function(a){var b=0;
return b+=this.padding.getMeasureSize(a),b+=this.border.getMeasureSize(a)},getInnerExtentSize:function(a){var b=0;return b+=this.padding.getExtentSize(a),b+=this.border.getExtentSize(a)},setAll:function(a,b,c){this[a].setAll(b,c)},setBorderRadius:function(a,b){this.border.setRadius(a,b)},setBorderColor:function(a,b){this.border.setColor(a,b)},setBorderStyle:function(a,b){this.border.setStyle(a,b)},clearBorderStart:function(a){this.border.clearStart(a)},clearBorderBefore:function(a){this.border.clearBefore(a)},clearBorderAfter:function(a){this.border.clearAfter(a)}},a}(),pb=function(){function a(a,b){this.width=a,this.height=b}return a.prototype={clone:function(){return new a(this.width,this.height)},setExtent:function(a,b){this[a.getPropExtent()]=b},setMeasure:function(a,b){this[a.getPropMeasure()]=b},getCss:function(){var a={};return a.width=this.width+"px",a.height=this.height+"px",a},getMeasure:function(a){return this[a.getPropMeasure()]},getExtent:function(a){return this[a.getPropExtent()]}},a}(),qb=function(){function a(a,b){b=b||{},this.position=a,this.top="undefined"!=typeof b.top?b.top:"auto",this.left="undefined"!=typeof b.left?b.left:"auto",this.right="undefined"!=typeof b.right?b.right:"auto",this.bottom="undefined"!=typeof b.bottom?b.bottom:"auto"}return a.prototype={isAbsolute:function(){return"absolute"===this.position},getCss:function(){var a={};return a.position=this.position,a.top=this.top,a.left=this.left,a.right=this.right,a.bottom=this.bottom,a}},a}(),rb=function(){function a(a,b){this.size=a,this.style=b,this.css={}}return a.prototype={debugSize:function(a){console.log("[%s](m,e) = (%d,%d), (m+,e+) = (%d,%d)",a||"no title",this.getContentMeasure(),this.getContentExtent(),this.getLayoutMeasure(),this.getLayoutExtent())},getDatasetAttr:function(){return"inline"===this.display&&this.style.isRootLine()?{}:this.style.getDatasetAttr()},getCssBlock:function(){var a={};return r.copy(a,this.style.getCssBlock()),r.copy(a,this.size.getCss(this.style.flow)),this.edge&&r.copy(a,this.edge.getCss()),r.copy(a,this.css),a},getCssInline:function(){var a={};return r.copy(a,this.style.getCssInline()),r.copy(a,this.size.getCss(this.style.flow)),this.edge&&r.copy(a,this.edge.getCss()),r.copy(a,this.css),a},getCssInlineBlock:function(){var a=this.getCssBlock();return a.display="inline-block",a},getCssHoriInlineImage:function(){var a=this.getCssInline();return a["vertical-align"]="middle",a},getContentMeasure:function(a){return a=a||this.style.flow,this.size.getMeasure(a)},getContentExtent:function(a){return a=a||this.style.flow,this.size.getExtent(a)},getContentWidth:function(){return this.size.width},getContentHeight:function(){return this.size.height},getEdgeMeasure:function(a){return a=a||this.style.flow,this.edge?this.edge.getMeasureSize(a):0},getEdgeExtent:function(a){return a=a||this.style.flow,this.edge?this.edge.getExtentSize(a):0},getLayoutMeasure:function(a){return a=a||this.style.flow,this.getContentMeasure(a)+this.getEdgeMeasure(a)},getLayoutExtent:function(a){return a=a||this.style.flow,this.getContentExtent(a)+this.getEdgeExtent(a)},clearBorderBefore:function(){this.edge&&this.edge.clearBorderBefore(this.style.flow)},clearBorderAfter:function(){this.edge&&this.edge.clearBorderAfter(this.style.flow)},resizeExtent:function(a,b){return this.size.setExtent(a,b),this}},a}(),sb=function(){function a(a){this.pos=0,this.buff=this._normalize(a),this.src=this.buff}var b=/\d\d|!\?|!!|\?!|\?\?/,c=/^([\w!\.\?\/\_:#;"',]+)/,d=/^(<[^>]+>)/,e=/^(&[^;\s]+;)/,f=["?xml","!doctype","br","end-page","hr","img","input","link","meta","pbr","page-break","wbr"];return a.prototype={_normalize:function(a){return a.replace(/(<\/[^>]+>)/g,function(a){return a.toLowerCase()}).replace(/^[ \n]+/,"").replace(/\s+$/,"").replace(/\r/g,"")},isEmpty:function(){return""===this.src},get:function(){var a=this._getToken();return a&&(a.spos=this.pos),a},getSrc:function(){return this.src},getSeekPercent:function(a){return Math.round(100*a/this.src.length)},_stepBuff:function(a){this.pos+=a,this.buff=this.buff.slice(a)},_getToken:function(){if(""===this.buff)return null;if(this.buff.match(d))return this._parseTag(RegExp.$1);if(this.buff.match(c)){var a=RegExp.$1;return 1===a.length?this._parseChar(a):2===a.length&&a.match(b)?this._parseTcy(a):this._parseWord(a)}return this.buff.match(e)?this._parseCharRef(RegExp.$1):this._parseChar(this._getChar())},_getRb:function(){var a=this.buffRb.substring(0,1);return this.buffRb=this.buffRb.slice(1),a},_getChar:function(){return this.buff.substring(0,1)},_getTagContentAux:function(a){var b=new RegExp("<"+a+"[\\s|>]"),c="</"+a+">",d=function(d){var e=d.indexOf(c);if(0>e)return-1;var f=d.match(b),g=f?f.index:-1;if(0>g||g>e)return e;var h=g+a.length+2,i=arguments.callee(d.substring(h));if(0>i)return-1;var j=h+i+a.length+3;return j+arguments.callee(d.substring(j))},e=d(this.buff);return 0>e?this.buff:this.buff.substring(0,e)},_getTagContent:function(a){try{return this._getTagContentAux(a)}catch(b){return""}},_parseTag:function(a){var b=new B(a);return this._stepBuff(a.length),h.exists(f,q.eq(b.getName()))?b:this._parseChildContentTag(b)},_parseTcyTag:function(a){var b=this._getTagContent(a.name);return this._stepBuff(b.length+a.name.length+3),new F(b)},_parseChildContentTag:function(a){var b=this._getTagContent(a.name);return a.setContent(k.trimCRLF(b)),this._stepBuff(b.length+a.name.length+3),a},_parseWord:function(a){return this._stepBuff(a.length),new E(a)},_parseTcy:function(a){return this._stepBuff(a.length),new F(a)},_parseChar:function(a){return this._stepBuff(a.length),new D(a,!1)},_parseCharRef:function(a){return this._stepBuff(a.length),new D(a,!0)}},a}(),tb=function(){function a(a,b,c){this.rank=a,this.title=b,this._id=c||0}return a.prototype={getId:function(){return this._id}},a}(),ub=function(){function a(a,b,c){this._type=a,this._header=null,this._auto=!1,this._next=null,this._child=null,this._parent=b||null,this._pageNo=c||0}return a.prototype={isRoot:function(){return null===this._parent},isAuto:function(){return this._auto},hasHeader:function(){return null!==this._header},hasHeaderId:function(){return this.getHeaderId()>0},hasChild:function(){return null!==this._child},hasNext:function(){return null!==this._next},getNext:function(){return this._next},getChild:function(){return this._child},getParent:function(){return this._parent},getHeader:function(){return this._header},getHeaderId:function(){return this._header?this._header.getId():null},setHeader:function(a){this._header=a},setAuto:function(){this._auto=!0},getRank:function(){return this._header?this._header.rank:0},getTitle:function(){return this._header?this._header.title:["untitled",this._type].join(" ")},getType:function(){return this._type},getPageNo:function(){return this._pageNo},updatePageNo:function(a){this._pageNo=a},addChild:function(a){null===this._child?this._child=a:this._child.addNext(a)},addNext:function(a){null===this._next?this._next=a:this._next.addNext(a)}},a}(),vb=function(){function a(){this.stack=[1]}return a.prototype={toString:function(){return this.stack.join(".")},stepNext:function(){return this.stack.length>0&&this.stack[this.stack.length-1]++,this},startRoot:function(){return this.stack.push(1),this},endRoot:function(){return this.stack.pop(),this}},a}(),wb=function(){function a(a){this.logs=[],this.style=a}var b=0,c=function(){return b++};return a.prototype={isEmpty:function(){return 0===this.logs.length},get:function(a){return this.logs[a]||null},getMarkupName:function(){return this.style.getMarkupName()},startSection:function(a){return this.logs.push({name:"start-section",type:a,pageNo:Ab.pageNo}),this},endSection:function(a){return this.logs.push({name:"end-section",type:a}),this},addHeader:function(a){var b=c();return this.logs.push({name:"set-header",type:a.type,rank:a.rank,title:a.title,pageNo:Ab.pageNo,headerId:b}),b}},a}(),xb=function(){var a=function(a,b,c){var d=a.get(c++);if(null!==d){switch(d.name){case"start-section":var e=new ub(d.type,b,d.pageNo);b&&b.addChild(e),arguments.callee(a,e,c);break;case"end-section":arguments.callee(a,b.getParent(),c);break;case"set-header":var f=new tb(d.rank,d.title,d.headerId);if(null===b){var g=new ub("section",null,d.pageNo);g.setHeader(f),arguments.callee(a,g,c)}else if(b.hasHeader()){var h=d.rank,i=b.getRank();if(i>h)c=Math.max(0,c-1),arguments.callee(a,b.getParent(),c);else if(d.rank==i){var j=new ub("section",b,d.pageNo);j.setHeader(f),b.addNext(j),arguments.callee(a,j,c)}else{var k=new ub("section",b,d.pageNo);k.setHeader(f),b.addChild(k),arguments.callee(a,k,c)}}else b.setHeader(f),arguments.callee(a,b,c)}return b}};return{parse:function(b){var c=0,d=new ub("section",null,0);return a(b,d,c)}}}(),yb=function(){var a={onClickLink:function(){return!1},createToc:function(a,b){return{tocPos:a.toString(),title:b.getTitle(),pageNo:b.getPageNo(),headerId:b.getHeaderId()}},createRoot:function(){var a=document.createElement("ul");return a.className="nehan-toc-root",a},createChild:function(){var a=document.createElement("li");return a.className="nehan-toc-item",a},createLink:function(a){var b=document.createElement("a"),c=a.title.replace(/<a[^>]+>/gi,"").replace(/<\/a>/gi,"");return b.href="#"+a.pageNo,b.innerHTML=c,b.className="nehan-toc-link",b.id=o.addNehanTocLinkPrefix(a.tocId),b},createPageNoItem:function(){return null}},b=function(a,b,c,d){if(null===c)return b;var e=d.createToc(a,c),f=d.createChild(e),g=d.createLink(e);g&&(g.onclick=function(){return d.onClickLink(e)},f.appendChild(g));var h=d.createPageNoItem(e);h&&f.appendChild(h),b.appendChild(f);var i=c.getChild();if(i){a=a.startRoot();var j=d.createToc(a,i),k=d.createRoot(j);arguments.callee(a,k,i,d),f.appendChild(k),a=a.endRoot()}var l=c.getNext();return l&&arguments.callee(a.stepNext(),b,l,d),b};return{convert:function(c,d){d=r.merge({},a,d||{});var e=new vb,f=d.createRoot();return b(e,f,c,d)}}}(),zb=function(){function a(){this.title="",this.metas=[],this.links=[],this.scripts=[],this.styles=[]}return a.prototype={setTitle:function(a){this.title=a},getTitle:function(){return this.title},addLink:function(a){this.links.push(a)},getLinks:function(){return this.links},addMeta:function(a){this.metas.push(a)},getMetas:function(){return this.metas},getMetaByName:function(a){return h.find(this.metas,function(b){return b.getTagAttr("name")===a})},getMetaContentByName:function(a){var b=this.getMetaByName(a);return b?b.getTagAttr("content"):null},addScript:function(a){this.scripts.push(a)},getScripts:function(){return this.scripts},addStyle:function(a){this.styles.push(a)},getStyles:function(){return this.styles}},a}(),Ab={documentType:"html",documentHeader:null,pageNo:0,anchors:{},outlineContexts:[],createBodyOutlineElement:function(a){var b=this.createOutlineElementsByName("body",a);return b.length>0?b[0]:null},getOutlineContextsByName:function(a){return h.filter(this.outlineContexts,function(b){return b.getMarkupName()===a})},createOutlineElementsByName:function(a,b){var c=this.getOutlineContextsByName(a);return h.fold(c,[],function(a,c){var d=xb.parse(c);return d?a.concat(yb.convert(d,b)):a})},addOutlineContext:function(a){this.outlineContexts.push(a)},addAnchor:function(a){this.anchors[a]=this.pageNo},getAnchorPageNo:function(a){return this.anchors[a]}},Bb=function(){function a(a){this.lexer=this._createLexer(a),this.tokens=[],this.pos=0,this.eof=!1,this._doBuffer()}return a.prototype={hasNext:function(){return!this.eof||this.pos<this.tokens.length},isEmpty:function(){return this.lexer.isEmpty()},isEmptyTokens:function(){return 0===this.tokens.length},isHead:function(){return 0===this.pos},prev:function(){this.pos=Math.max(0,this.pos-1)},setPos:function(a){this.pos=a},rewind:function(){this.pos=0},peek:function(a){var b=a||0,c=Math.max(0,this.pos+b);if(c>=this.tokens.length){if(this.eof)return null;this._doBuffer()}var d=this.tokens[c];return d?(d.pos=c,d):null},get:function(){var a=this.peek();return this.pos++,a},getSrc:function(){return this.lexer.getSrc()},getPos:function(){return this.pos},getTokenCount:function(){return this.tokens.length},getSeekPos:function(){var a=this.tokens[this.pos];return a?a.spos:0},getSeekPercent:function(){var a=this.getSeekPos();return this.lexer.getSeekPercent(a)},getAll:function(){for(;!this.eof;)this._doBuffer();return this.tokens},getAllIf:function(a){return h.filter(this.getAll(),function(b){return a(b)})},getWhile:function(a){for(var b,c=[];this.hasNext();){if(b=this.get(),!b||!a(b)){this.prev();break}c.push(b)}return c},skipUntil:function(a){for(;this.hasNext();){var b=this.get();if(null===b)break;if(!a(b)){this.prev();break}}},_createLexer:function(a){return new sb(a)},_doBuffer:function(){for(var a=c.lexingBufferLen,b=0;a>b;b++){var d=this.lexer.get();if(null===d){this.eof=!0;break}this.tokens.push(d)}}},a}(),Cb=function(){function a(a,b){Bb.call(this,a);var c=0;this.tokens=this.getAllIf(function(a){return C.isText(a)?!1:b(a)?(a.order=c++,!0):void 0})}return g.extend(a,Bb),a}(),Db=function(){function a(a){Cb.call(this,a,function(a){var b=a.getName();return"!doctype"===b||"html"===b}),this.isEmptyTokens()&&(this.tokens=[new B("html",a)])}return g.extend(a,Cb),a}(),Eb=function(){function a(a){Cb.call(this,a,function(a){var b=a.getName();return"head"===b||"body"===b})}return g.extend(a,Cb),a}(),Fb=function(){function a(a){Cb.call(this,a,function(a){var b=a.getName();return"title"===b||"meta"===b||"link"===b||"style"===b||"script"===b})}return g.extend(a,Cb),a}(),Gb=function(){function a(a){Bb.call(this,a.getContent()),this.getAll(),this.tokens=this._parse(a),this.rewind()}return g.extend(a,Bb),a.prototype._parse=function(a){for(var b=[];this.hasNext();)b.push(this._parseRuby(a));return b},a.prototype._parseRuby=function(){for(var a=[],b=null;;){var c=this.get();if(null===c)break;if(C.isTag(c)&&"rt"===c.getName()){b=c;break}C.isText(c)&&a.push(c)}return new G(a,b)},a}(),Hb=function(){function a(a){r.merge(this,{html:"",seekPos:0,pageNo:0,charPos:0,charCount:0,percent:0},a)}return a.prototype={getGroupSize:function(){return 1},getGroupHtml:function(){return this.html}},a}(),Ib=function(){function a(){this.evaluator=this._getEvaluator()}return a.prototype={_getEvaluator:function(){return"vert"===d.direction?new uc:new vc},evaluate:function(a){return a?new Hb({html:this.evaluator.evaluate(a),percent:a.percent,seekPos:a.seekPos,pageNo:a.pageNo,charPos:a.charPos,charCount:a.charCount}):null}},a}(),Jb=function(){function a(a){this.groupSize=a,Ib.call(this)}return g.extend(a,Ib),a.prototype.evaluate=function(a){var b=this,c=h.map(a,function(a){return Ib.prototype.evaluate.call(b,a)});return new Lb(this.groupSize,c)},a}(),Kb=function(){function a(a,b){this.text=this._createSource(a),this.groupSize=b,this.generator=this._createGenerator(this.text),this.evaluator=this._createEvaluator(),this.buffer=[],this._timeStart=null,this._timeElapsed=null}return a.prototype={hasPage:function(a){return"undefined"!=typeof this.buffer[a]},hasNext:function(){return this.generator.hasNext()},syncGet:function(){var a=0;for(this._setTimeStart();this.hasNext();){if(!this.hasPage(a)){var b=this._yield();this._addBuffer(b)}{this.getPage(a)}a++}return this._setTimeElapsed()},asyncGet:function(a){r.merge(this,{onComplete:function(){},onProgress:function(){},onError:function(){}},a||{}),this._setTimeStart(),this._asyncGet(a.wait||0)},getPageCount:function(){return this.buffer.length},getGroupPageNo:function(a){return a},getTimeElapsed:function(){return this._timeElapsed},get:function(a){return this.getPage(a)},getPage:function(a){var b=this.buffer[a];if(this._isEvaluated(b))return b;var c=this.evaluator.evaluate(b);return this.buffer[a]=c,c},_yield:function(){return this.generator.yield()},_isEvaluated:function(a){return a instanceof Hb},_setTimeStart:function(){return this._timeStart=(new Date).getTime(),this._timeStart},_setTimeElapsed:function(){return this._timeElapsed=(new Date).getTime()-this._timeStart,this._timeElapsed},_asyncGet:function(a){if(!this.generator.hasNext())return void this.onComplete(this,this._setTimeElapsed());var b=this._yield();b&&(this._addBuffer(b),this.onProgress(this,b));var c=this;m(function(){c._asyncGet(a)})},_addBuffer:function(a){this.buffer.push(a)},_createSource:function(a){return a.replace(/(<\/[a-zA-Z0-9\-]+>)[\s]+</g,"$1<").replace(/\t/g,"").replace(/<!--[\s\S]*?-->/g,"").replace(/<rp>[^<]*<\/rp>/gi,"").replace(/<rb>/gi,"").replace(/<\/rb>/gi,"").replace(/<rt><\/rt>/gi,"")},_createGenerator:function(a){switch(d.root){case"document":return new sc(a);case"html":return new rc(a);default:return new qc(a)}},_createEvaluator:function(){return new Ib}},a}(),Lb=function(){function a(a,b){var c=b[0];Hb.call(this,{percent:c.percent,pageNo:c.pageNo,seekPos:c.seekPos,charPos:c.charPos,charCount:h.sum(b,function(a){return a.charCount})}),this.groupSize=a,this.pages=b}return g.extend(a,Hb),a.prototype.getGroupSize=function(){return this.groupSize},a.prototype.getGroupHtml=function(a){var b=this.pages[a]||null;return b?b.html:""},a}(),Mb=function(){function a(a,b){Kb.call(this,a,b)}return g.extend(a,Kb),a.prototype.getGroupPageNo=function(a){return Math.round(a/this.groupSize)},a.prototype._yield=function(){for(var a=[],b=function(b){b&&a.push(b)};a.length<this.groupSize&&this.hasNext();)b(this.generator.yield());return a},a.prototype._isEvaluated=function(a){return a instanceof Lb},a.prototype._createEvaluator=function(){return new Jb(this.groupSize)},a}(),Nb={set:function(a,b,c){a.isKakkoStart()?this._setKerningStart(a,b):(a.isKakkoEnd()||a.isKutenTouten())&&this._setKerningEnd(a,c)},_setKerningStart:function(a,b){var c=this._getTextSpaceStart(a,b);c>0&&(a.spaceRateStart=c)},_setKerningEnd:function(a,b){var c=this._getTextSpaceEnd(a,b);c>0&&(a.spaceRateEnd=c)},_getTextSpaceStart:function(a,b){return null===b?.5:C.isChar(b)&&b.isKakkoStart()?0:.5},_getTextSpaceEnd:function(a,b){return null===b?.5:C.isChar(b)&&(b.isKakkoEnd()||b.isKutenTouten())?0:.5}},Ob=function(){function a(a){this.value=a||"none"}return a.prototype={getCss:function(a){var b={};return a.isTextHorizontal()&&(this.isStart()?b["float"]="left":this.isEnd()&&(b["float"]="right")),b},isStart:function(){return"start"===this.value},isEnd:function(){return"end"===this.value},isNone:function(){return"none"===this.value}},a}(),Pb={start:new Ob("start"),end:new Ob("end"),none:new Ob("none"),get:function(a){return this[a]||null}},Qb=function(){function a(a){this.value=a}return a.prototype={isAlways:function(){},isAvoid:function(){},isFirst:function(){},isNth:function(){}},a}(),Rb={before:{always:new Qb("always"),avoid:new Qb("avoid"),first:new Qb("first"),second:new Qb("second")},after:{always:new Qb("always"),avoid:new Qb("avoid"),first:new Qb("first"),second:new Qb("second")},getBefore:function(a){return this.before[a]||null},getAfter:function(a){return this.after[a]||null}},Sb=function(){function a(a){this.value=a||"start"}return a.prototype={isStart:function(){return"start"===this.value},isEnd:function(){return"end"===this.value},isCenter:function(){return"center"===this.value},getCss:function(){var a={};return"center"===this.value,a}},a}(),Tb={start:new Sb("start"),end:new Sb("end"),center:new Sb("center"),get:function(a){return this[a]||null}},Ub=function(){function a(a,b,c){this._initialize(a,b,c)}var b=/(^(<[^>]+>|[\s\n])*)(\S)/im;return a.prototype={_initialize:function(a,b,c){c=c||{},this.markup=a,this.parent=b||null,this.markupName=a.getName(),this.childs=[],this.next=null,b&&b.appendChild(this),this.selectorCss={},this.inlineCss={},r.copy(this.selectorCss,this._loadSelectorCss(a,b)),r.copy(this.selectorCss,this._loadCallbackCss("onload",c.context||null)),r.copy(this.inlineCss,this._loadInlineCss(a)),r.copy(this.inlineCss,this._loadCallbackCss("inline",c.context||null)),r.copy(this.inlineCss,c.forceCss||{}),this.display=this._loadDisplay(),this.flow=this._loadFlow(),this.boxSizing=this._loadBoxSizing();var e=this._loadColor();e&&(this.color=e);var f=this._loadBackground();f&&(this.background=f);var g=this._loadFont();g&&(this.font=g);var h=this._loadPosition();h&&(this.position=h);var i=this._loadEdge(this.flow,this.getFontSize());i&&(this.edge=i);var j=this._loadLineRate();j&&(this.lineRate=j);var k=this._loadTextAlign();k&&(this.textAlign=k);var l=this._loadTextEmpha();l&&(this.textEmpha=l);var m=this._loadTextCombine();m&&(this.textCombine=m);var n=this._loadListStyle();n&&(this.listStyle=n);var o=this._loadFloatDirection();o&&(this.floatDirection=o);var p=this._loadBreakBefore();p&&(this.breakBefore=p);var q=this._loadBreakAfter();q&&(this.breakAfter=q),this.staticMeasure=this._loadStaticMeasure(),this.staticExtent=this._loadStaticExtent(),this.outerMeasure=this.staticMeasure||(this.parent?this.parent.contentMeasure:d.getMeasure(this.flow)),this.outerExtent=this.staticExtent||(this.parent?this.parent.contentExtent:d.getExtent(this.flow)),this.contentMeasure=this._computeContentMeasure(this.outerMeasure),this.contentExtent=this._computeContentExtent(this.outerExtent)},clone:function(b){return null===this.parent?this.createChild("div",b):new a(this.markup.clone(),this.parent,{forceCss:b||{}})},appendChild:function(a){this.childs.length>0&&(h.last(this.childs).next=a),this.childs.push(a)},removeChild:function(a){var b=h.indexOf(this.childs,q.eq(a));if(b>=0){var c=this.childs.splice(b,1);return c}return null},createChild:function(b,c){var d=new B("<"+b+">"),e=new a(d,this,{forceCss:c||{}});return e.contextParent=this.parent,e},createBlock:function(a){a=a||{};var b=a.elements||[],c=this.contentMeasure,d=this.parent&&a.extent&&null===this.staticExtent?a.extent:this.contentExtent,e=this.flow.getBoxSize(c,d),f=["nehan-block","nehan-"+this.getMarkupName()],g=new rb(e,this);return g.display="inline-block"===this.display?this.display:"block",g.edge=this.edge||null,g.elements=b,g.classes=f,g.charCount=h.fold(b,0,function(a,b){return a+(b?b.charCount||0:0)}),g},createImage:function(){var a=this.staticMeasure||this.font.size,b=this.staticExtent||this.font.size,c=$.getByName("lr-tb").getBoxSize(a,b),d=new rb(c,this);return d.display=this.display,d.edge=this.edge||null,d.classes=["nehan-block","nehan-image"],d.charCount=0,this.isPushed()?d.pushed=!0:this.isPulled()&&(d.pulled=!0),d},createLine:function(a){a=a||{};var b=a.elements||[],c=this._filterChildLines(b),d=this._computeMaxLineFontSize(c),e=this._computeMaxLineExtent(c,d),f=this.parent&&a.measure&&null===this.staticMeasure&&!this.isRootLine()?a.measure:this.contentMeasure,g=this.isRootLine()&&c.length>0?e:this.getAutoLineExtent(),h=this.flow.getBoxSize(f,g),i=["nehan-inline","nehan-inline-"+this.flow.getName()],j=new rb(h,this);return j.display="inline",j.elements=a.elements||[],j.classes=this.isRootLine()?i:i.concat("nehan-"+this.markup.getName()),j.charCount=a.charCount||0,j.edge=this.edge&&!this.isRootLine()?this.edge:null,this.isRootLine()&&(j.br=a.br||!1,j.inlineMeasure=a.measure||this.contentMeasure,j.texts=a.texts||[],this.isTextVertical()&&this._alignVertBaselines(c,d,e),this.textAlign&&!this.textAlign.isStart()&&this._setTextAlign(j,this.textAlign)),j},isBlock:function(){switch(this.display){case"block":case"table":case"table-caption":case"table-row":case"table-row-group":case"table-header-group":case"table-footer-group":case"table-cell":case"list-item":return!0}return!1},isRoot:function(){return null===this.parent},isChildBlock:function(){return this.isBlock()&&!this.isRoot()},isInlineBlock:function(){return"inline-block"===this.display},isInline:function(){return"inline"===this.display},isRootLine:function(){return this.isBlock()||this.isInlineBlock()},isFloatStart:function(){return this.floatDirection&&this.floatDirection.isStart()},isFloatEnd:function(){return this.floatDirection&&this.floatDirection.isEnd()},isFloated:function(){return this.isFloatStart()||this.isFloatEnd()},isParallel:function(){return"list-item"===this.display},isPushed:function(){return null!==this.getMarkupAttr("pushed")},isPulled:function(){return null!==this.getMarkupAttr("pulled")},isTextEmphaEnable:function(){return this.textEmpha&&this.textEmpha.isEnable()},isTextVertical:function(){return this.flow.isTextVertical()},isTextHorizontal:function(){return this.flow.isTextHorizontal()},isPre:function(){var a=this.getCssAttr("white-space","normal");return"pre"===a},isFirstChild:function(){var a=this.getParentChilds();return a.length>0&&a[0]===this},isFirstOfType:function(){var a=this.getParentChildsOfType(this.getMarkupName());return a.length>0&&a[0]===this},isLastChild:function(){return!1},isLastOfType:function(){return!1},isOnlyChild:function(){var a=this.getParentChilds();return 1===a.length&&a[0]===this},isOnlyOfType:function(){var a=this.getParentChildsOfType(this.getMarkupName());return 1===a.length&&a[0]===this},isEmpty:function(){return""===this.getMarkupContent()},hasFlipFlow:function(){return this.parent?this.flow!==this.parent.flow:!1},hasMarkupClassName:function(a){return this.markup.hasClass(a)},setCssAttr:function(a,b){this.inlineCss[a]=b},setCssAttrs:function(a){for(var b in a)this.setCssAttr(b,a[b])},getAttr:function(a,b){var c=this.getMarkupAttr(a);return"undefined"!=typeof c&&null!==c?c:(c=this.getCssAttr(a),"undefined"!=typeof c&&null!==c?c:"undefined"!=typeof b?b:null)},getMarkupAttr:function(a){return"id"===a?this.markup.id:this.markup.getAttr(a)},getCssAttr:function(a,b){var c;return c=this.getInlineCssAttr(a),null!==c?c:(c=this.getSelectorCssAttr(a),null!==c?c:"undefined"!=typeof b?b:null)},getInlineCssAttr:function(a){return this.inlineCss[a]||null},getSelectorCssAttr:function(a){return this.selectorCss[a]||null},getDatasetAttr:function(){return this.markup.getDatasetAttr()},getMarkupName:function(){return this.markup.getName()},getMarkupId:function(){return this.markup.id},getMarkupContent:function(){return this.markup.getContent()},getMarkupPos:function(){return this.markup.pos},getContent:function(){var a=this.markup.getContent(),c=z.getValuePe(this,"before");i.isEmpty(c)||(a=p.tagWrap("before",c.content||"")+a);var d=z.getValuePe(this,"after");i.isEmpty(d)||(a+=p.tagWrap("after",d.content||""));var e=z.getValuePe(this,"first-letter");i.isEmpty(e)||(a=a.replace(b,function(a,b,c,d){return b+p.tagWrap("first-letter",d)}));var f=z.getValuePe(this,"first-line");return i.isEmpty(f)||(a=p.tagWrap("first-line",a)),a},getHeaderRank:function(){return this.markup.getHeaderRank()},getFontSize:function(){return this.font.size},getFontFamily:function(){return this.font.family||this.flow.isTextVertical()?d.vertFontFamily:d.horiFontFamily},getTextAlign:function(){return this.textAlign||Tb.get("start")},getTextCombine:function(){return this.textCombine||null},getLetterSpacing:function(){return this.letterSpacing||0},getMarkerHtml:function(a){return this.listStyle?this.listStyle.getMarkerHtml(a):""},getColor:function(){return this.color||d.fontColor},getChildCount:function(){return this.childs.length},getChildIndex:function(){return this.parent?this.parent.findChildIndex(this):0},getChildIndexOfType:function(){return this.parent?this.parent.findChildIndexOfType(this):0},getNthChild:function(a){return this.childs[a]||null},getParentChilds:function(){return this.parent?this.parent.childs:[]},getParentChildsOfType:function(a){return h.filter(this.getParentChilds(),function(b){return b.getMarkupName()===a})},getParentFlow:function(){return this.parent?this.parent.flow:this.flow},getNextSibling:function(){return this.next},getLineRate:function(){return this.lineRate||d.lineRate||2},getEmphaLineExtent:function(){return 3*this.getFontSize()},getRubyLineExtent:function(){var a=this.getFontSize(),b=Math.floor(a*this.getLineRate()),c=d.getRtFontSize(a);return b+c},getAutoLineExtent:function(){return this.isTextEmphaEnable()?this.getEmphaLineExtent():"ruby"===this.getMarkupName()?this.getRubyLineExtent():Math.floor(this.getFontSize()*this.getLineRate())},getEdge:function(){return this.contextParent?this.contextParent.getEdge():this.edge||null},getEdgeMeasure:function(a){var b=this.getEdge();return b?b.getMeasureSize(a||this.flow):0},getEdgeExtent:function(a){var b=this.getEdge();return b?b.getExtentSize(a||this.flow):0},getInnerEdgeMeasure:function(){var a=this.getEdge();return a?a.getInnerMeasureSize():0},getInnerEdgeExtent:function(){var a=this.getEdge();return a?a.getInnerExtentSize():0},getCssBlock:function(){var a={};return a.display="block",this.font&&r.copy(a,this.font.getCss()),this.parent&&r.copy(a,this.parent.flow.getCss()),this.color&&r.copy(a,this.color.getCss()),this.background&&r.copy(a,this.background.getCss(this.flow)),this.letterSpacing&&!this.flow.isTextVertical()&&(a["letter-spacing"]=this.letterSpacing+"px"),this.floatDirection&&r.copy(a,this.floatDirection.getCss(this.flow)),a.overflow="hidden",this.zIndex&&(a["z-index"]=this.zIndex),a},getCssInline:function(){var a={};return a["line-height"]="1em",this.parent&&this.isRootLine()&&r.copy(a,this.parent.flow.getCss()),this.font&&r.copy(a,this.font.getCss()),this.color&&r.copy(a,this.color.getCss()),this.background&&r.copy(a,this.background.getCss()),this.isRootLine()&&r.copy(a,this.flow.getCss()),this.flow.isTextVertical()&&(e.isIphoneFamily&&(a["letter-spacing"]="-0.001em"),"ruby"!==this.markup.getName()&&(a["margin-left"]=a["margin-right"]="auto",a["text-align"]="center")),a},findChildIndex:function(a){return h.indexOf(this.childs,function(b){return b===a})},findChildsOfType:function(a){var b=a.getMarkupName();return h.filter(this.childs,function(a){return a.getMarkupName()===b})},findChildIndexOfType:function(a){return h.indexOf(this.findChildsOfType(a),function(b){return b===a})},_filterChildLines:function(a){return h.filter(a,function(a){return a.style?!0:!1})},_computeContentMeasure:function(a){switch(this.boxSizing){case"margin-box":return a-this.getEdgeMeasure();case"border-box":return a-this.getInnerEdgeMeasure();case"content-box":default:return a}},_computeContentExtent:function(a){switch(this.boxSizing){case"margin-box":return a-this.getEdgeExtent();case"border-box":return a-this.getInnerEdgeExtent();case"content-box":default:return a}},_computeMaxLineFontSize:function(a){return h.fold(a,this.getFontSize(),function(a,b){return Math.max(a,b.style.getFontSize())})},_computeMaxLineExtent:function(a,b){var c=this.flow;return h.fold(a,this.getAutoLineExtent(),function(a,d){var e=d.style.getFontSize(),f=Math.floor((b-e)/2);return Math.max(a,d.size.getExtent(c)+f)})},_setTextAlign:function(a,b){var c=a.getContentMeasure(this.flow),d=c-a.inlineMeasure;if(!(0>=d)){var e=new hb;if(b.isCenter()){var f=Math.floor(d/2);a.size.setMeasure(this.flow,c-f),e.setStart(this.flow,f),r.copy(a.css,e.getCss())}else b.isEnd()&&(a.size.setMeasure(this.flow,a.inlineMeasure),e.setStart(this.flow,d),r.copy(a.css,e.getCss()))}},_alignVertBaselines:function(a,b,c){var d=this.flow,e=this.getFontSize(),f=Math.floor(c/2);h.iter(a,function(a){var b=a.style.getFontSize(),g=f-Math.floor(b/2);(a.style.isTextEmphaEnable()||"ruby"===a.style.getMarkupName()||b!==e)&&(a.style&&"img"===a.style.getMarkupName()||g>0&&(a.edge=a.style.edge?a.style.edge.clone():new ob,a.edge.padding.setAfter(d,g),a.size.setExtent(d,c-g),r.copy(a.css,a.edge.getCss(d)),r.copy(a.css,a.size.getCss(d))))})},_loadSelectorCss:function(a,b){switch(a.getName()){case"before":case"after":case"first-letter":case"first-line":return z.getValuePe(b,a.getName());default:return z.getValue(this)}},_loadInlineCss:function(a){var b=a.getAttr("style");if(null===b)return{};var c=b.indexOf(";")>=0?b.split(";"):[b];return h.fold(c,{},function(a,b){var c=b.split(":");if(c.length>=2){var d=k.trim(c[0]).toLowerCase(),e=k.trim(c[1]);a[d]=s.format(d,e)}return a})},_loadCallbackCss:function(a,b){var c=this.getSelectorCssAttr(a);return null===c?{}:"function"==typeof c?c(this,b||null)||{}:"object"==typeof c?c:{}},_loadDisplay:function(){return this.getCssAttr("display","inline")},_loadFlow:function(){var a=this.getCssAttr("flow","inherit"),b=this.parent?this.parent.flow:d.getStdBoxFlow();return"inherit"===a?b:"flip"===a?b.getFlipFlow():$.getByName(a)},_loadPosition:function(){var a=this.getCssAttr("position","relative");
return new qb(a,{top:this.getCssAttr("top","auto"),left:this.getCssAttr("left","auto"),right:this.getCssAttr("right","auto"),bottom:this.getCssAttr("bottom","auto")})},_loadColor:function(){var a=this.getCssAttr("color","inherit");return"inherit"!==a?new I(a):void 0},_loadFont:function(){var a=this.parent?this.parent.font.size:d.fontSize,b=new bb(a),c=this.getCssAttr("font-size","inherit");"inherit"!==c&&(b.size=j.getFontSize(c,a));var e=this.getCssAttr("font-family","inherit");"inherit"!==e?b.family=e:null===this.parent&&(b.family=d.getStdFontFamily());var f=this.getCssAttr("font-weight","inherit");"inherit"!==f&&(b.weight=f);var g=this.getCssAttr("font-style","inherit");return"inherit"!==g&&(b.style=g),b},_loadBoxSizing:function(){return this.getCssAttr("box-sizing","margin-box")},_loadEdge:function(a,b){var c=this.getCssAttr("padding"),d=this.getCssAttr("margin"),e=this.getCssAttr("border-width");if(null===c&&null===d&&null===e)return null;var f=new ob;c&&f.padding.setSize(a,j.getEdgeSize(c,b)),d&&f.margin.setSize(a,j.getEdgeSize(d,b)),e&&f.border.setSize(a,j.getEdgeSize(e,b));var g=this.getCssAttr("border-radius");g&&f.setBorderRadius(a,j.getCornerSize(g,b));var h=this.getCssAttr("border-color");h&&f.setBorderColor(a,h);var i=this.getCssAttr("border-style");return i&&f.setBorderStyle(a,i),f},_loadLineRate:function(){var a=this.getCssAttr("line-rate","inherit");return"inherit"===a&&this.parent&&this.parent.lineRate?this.parent.lineRate:parseFloat(a||d.lineRate)},_loadTextAlign:function(){var a=this.getCssAttr("text-align","inherit");return"inherit"===a&&this.parent&&this.parent.textAlign?this.parent.textAlign:Tb.get(a||"start")},_loadTextEmpha:function(){var a=this.parent?this.parent.getColor():d.fontColor,b=this.getCssAttr("text-emphasis-style","none");if("none"===b||"inherit"===b)return null;var c=this.getCssAttr("text-emphasis-position",{hori:"over",vert:"right"}),e=this.getCssAttr("text-emphasis-color",a);return new mb({style:new kb(b),pos:new lb(c),color:new I(e)})},_loadTextEmphaStyle:function(){var a=this.getCssAttr("text-emphasis-style","inherit");return"inherit"!==a?new kb(a):null},_loadTextEmphaPos:function(){return this.getCssAttr("text-emphasis-position",{hori:"over",vert:"right"})},_loadTextEmphaColor:function(a){return this.getCssAttr("text-emphasis-color",a.getValue())},_loadTextCombine:function(){return this.getCssAttr("text-combine")},_loadFloatDirection:function(){var a=this.getCssAttr("float","none");return"none"===a?null:Pb.get(a)},_loadBreakBefore:function(){var a=this.getCssAttr("break-before");return a?Rb.getBefore(a):null},_loadBreakAfter:function(){var a=this.getCssAttr("break-after");return a?Rb.getAfter(a):null},_loadListStyle:function(){var a=this.getCssAttr("list-style-type","none");return"none"===a?null:new Q({type:a,position:this.getCssAttr("list-style-position","outside"),image:this.getCssAttr("list-style-image","none"),format:this.getCssAttr("list-style-format")})},_loadLetterSpacing:function(a){var b=this.getCssAttr("letter-spacing");return b?j.getUnitSize(b,a):void 0},_loadBackground:function(){var a=this.getCssAttr("background-color"),b=this.getCssAttr("background-image"),c=this.getCssAttr("background-position");if(null===a&&null===b&&null===c)return null;var d=new Y;a&&(d.color=new I(a)),b&&(d.image=b),c&&(d.pos=new V(new U(c.inline,c.offset),new U(c.block,c.offset)));var e=this.getCssAttr("background-repeat");return e&&(d.repeat=new X(new W(e.inline),new W(e.block))),d},_loadStaticMeasure:function(){var a=this.flow.getPropMeasure(),b=d.getMeasure(this.flow),c=this.getAttr(a)||this.getAttr("measure")||this.getCssAttr(a)||this.getCssAttr("measure");return c?j.getBoxSize(c,this.font.size,b):null},_loadStaticExtent:function(){var a=this.flow.getPropExtent(),b=d.getExtent(this.flow),c=this.getAttr(a)||this.getAttr("extent")||this.getCssAttr(a)||this.getCssAttr("extent");return c?j.getBoxSize(c,this.font.size,b):null}},a}(),Vb=function(){function a(a,b){this.block=a,this.inline=b}return a.prototype={isBlockSpaceLeft:function(){return this.block.isSpaceLeft()},hasBlockSpaceFor:function(a){return this.block.hasSpaceFor(a)},addBlockElement:function(a,b){this.block.addElement(a,b)},pushBlockElement:function(a,b){this.block.pushElement(a,b)},pullBlockElement:function(a,b){this.block.pullElement(a,b)},getBlockElements:function(){return this.block.getElements()},getBlockCurExtent:function(){return this.block.getCurExtent()},getBlockMaxExtent:function(){return this.block.getMaxExtent()},getBlockRestExtent:function(){return this.block.getRestExtent()},isInlineEmpty:function(){return this.inline.isEmpty()},isInlineSpaceLeft:function(){return this.inline.isSpaceLeft()},hasInlineSpaceFor:function(a){return this.inline.hasSpaceFor(a)},hasBr:function(){return this.inline.hasBr()},setLineBreak:function(a){this.inline.setLineBreak(a)},addInlineElement:function(a,b){this.inline.addElement(a,b)},getInlineLastText:function(){return this.inline.getLastText()},getInlineTexts:function(){return this.inline.getTexts()},getInlineElements:function(){return this.inline.getElements()},getInlineCurMeasure:function(){return this.inline.getCurMeasure()},getInlineRestMeasure:function(){return this.inline.getRestMeasure()},getInlineMaxMeasure:function(){return this.inline.getMaxMeasure()},getInlineCharCount:function(){return this.inline.getCharCount()},justify:function(a){return this.inline.justify(a)}},a}(),Wb=function(){function a(a){this.curExtent=0,this.maxExtent=a,this.pushedElements=[],this.elements=[],this.pulledElements=[]}return a.prototype={isSpaceLeft:function(){return this.getRestExtent()>0},hasSpaceFor:function(a){return this.getRestExtent()>=a},addElement:function(a,b){this.elements.push(a),this.curExtent+=b},pushElement:function(a,b){this.pushedElements.push(a),this.curExtent+=b},pullElement:function(a,b){this.pulledElements.unshift(a),this.curExtent+=b},getCurExtent:function(){return this.curExtent},getRestExtent:function(){return this.maxExtent-this.curExtent},getMaxExtent:function(){return this.maxExtent},getElements:function(){return this.pulledElements.concat(this.elements).concat(this.pushedElements)}},a}(),Xb=function(){function a(a){this.charCount=0,this.curMeasure=0,this.maxMeasure=a,this.elements=[],this.texts=[],this.br=!1}return a.prototype={isEmpty:function(){return!this.br&&0===this.elements.length},isSpaceLeft:function(){return this.getRestMeasure()>0},hasSpaceFor:function(a){return this.getRestMeasure()>=a},hasBr:function(){return this.br},setLineBreak:function(a){this.br=a},addElement:function(a,b){this.elements.push(a),C.isText(a)&&(this.texts.push(a),a.getCharCount&&(this.charCount+=a.getCharCount())),this.curMeasure+=b},getLastText:function(){return h.last(this.texts)},getTexts:function(){return this.texts},getElements:function(){return this.elements},getCurMeasure:function(){return this.curMeasure},getRestMeasure:function(){return this.maxMeasure-this.curMeasure},getMaxMeasure:function(){return this.maxMeasure},getCharCount:function(){return this.charCount},getLastChar:function(){return h.last(this.texts)},justify:function(a){for(var b=this.texts.length-1,c=b;c>=0;){var d=this.texts[c];if(!(a&&a.isHeadNg&&a.isHeadNg()||d.isTailNg&&d.isTailNg()))break;a=d,c--}return c>=0&&b>c?(this.elements=h.filter(this.elements,function(a){return a.pos?a.pos<=d.pos:!0}),d):null}},a}(),Yb=function(){function a(a,b){this.style=a,this.stream=b,this._childLayout=null,this._cachedElements=[],this._terminate=!1}return a.prototype.yield=function(a){var b=a?this._createChildContext(a):this._createStartContext();return this._yield(b)},a.prototype._yield=function(){throw"LayoutGenerator::_yield must be implemented in child class"},a.prototype.cloneStyle=function(a){var b=this.style,c=this.style.clone(a);this.style=c,this._childLayout&&this._childLayout.style===b&&(this._childLayout.style=c)},a.prototype.setTerminate=function(a){this._terminate=a},a.prototype.setChildLayout=function(a){this._childLayout=a},a.prototype.hasNext=function(){return this._terminate?!1:this.hasCache()?!0:this.hasChildLayout()?!0:this.stream?this.stream.hasNext():!1},a.prototype.hasChildLayout=function(){return this._childLayout&&this._childLayout.hasNext()?!0:!1},a.prototype.hasCache=function(){return this._cachedElements.length>0},a.prototype.yieldChildLayout=function(a){var b=this._childLayout.yield(a);return b},a.prototype.peekLastCache=function(){return h.last(this._cachedElements)},a.prototype.pushCache=function(a){var b=a.cacheCount||0;return b>0&&b>=c.maxRollbackCount?(console.error("[%s] too many cache count(%d), force terminate:%o",this.style.getMarkupName(),b,this.style),void this.setTerminate(!0)):(a.cacheCount=b+1,void this._cachedElements.push(a))},a.prototype.popCache=function(){var a=this._cachedElements.pop();return a},a.prototype.clearCache=function(){this._cachedElements=[]},a.prototype._onAddElement=function(){},a.prototype._onCreate=function(){},a.prototype._onComplete=function(){},a.prototype._createStartContext=function(){return new Vb(new Wb(this.style.contentExtent),new Xb(this.style.contentMeasure))},a.prototype._createChildContext=function(a){return new Vb(new Wb(a.getBlockRestExtent()-this.style.getEdgeExtent()),new Xb(this.style.contentMeasure))},a.prototype._createStream=function(a,b){switch(b.getName()){case"ruby":return new Gb(b);default:return new Bb(a.getContent(b))}},a}(),Zb=function(){function a(a,b,c){Yb.call(this,a,b),this.outlineContext=c}g.extend(a,Yb);var b=function(a){var b=a.elements[0];return b instanceof rb?b.style.getMarkupPos():b.pos};return a.prototype.popCache=function(a){var c=Yb.prototype.popCache.call(this);return this.hasChildLayout()&&"inline"===c.display?c.getLayoutMeasure(this.style.flow)<=this.style.contentMeasure&&c.br?c:(this._childLayout.stream.setPos(b(c)),this._childLayout.clearCache(),this.yieldChildLayout(a)):c},a.prototype._yield=function(a){if(!a.isBlockSpaceLeft())return null;for(;this.hasNext();){var b=this._getNext(a);if(null===b)break;var c=b.getLayoutExtent(this.style.flow);if(!a.hasBlockSpaceFor(c)){this.pushCache(b);break}if(this._addElement(a,b,c),!a.isBlockSpaceLeft())break}return this._createOutput(a)},a.prototype._getNext=function(b){if(this.hasCache()){var c=this.popCache(b);return c}if(this.hasChildLayout())return this.yieldChildLayout(b);var d=this.stream?this.stream.get():null;if(null===d)return null;var e=d instanceof B?new Ub(d,this.style,{context:b}):this.style;if(C.isText(d)||e.isInline()||e.isInlineBlock())return C.isWhiteSpace(d)?(this.stream.skipUntil(C.isWhiteSpace),this._getNext(b)):(this.stream.prev(),this.setChildLayout(new $b(this.style,this.stream,this.outlineContext)),this.yieldChildLayout(b));if(e.isFloated())return this.stream.prev(),this.setChildLayout(new fc(this.style,this.stream,b,this.outlineContext)),this.yieldChildLayout(b);var f=this._createStream(e,d);if(e.hasFlipFlow())return this.setChildLayout(new cc(e,f,this.outlineContext,b)),this.yieldChildLayout(b);switch(e.display){case"list-item":return this.setChildLayout(new kc(e,f,this.outlineContext)),this.yieldChildLayout(b);case"table":return this.setChildLayout(new lc(e,f,this.outlineContext)),this.yieldChildLayout(b);case"table-header-group":case"table-row-group":case"table-footer-group":return this.setChildLayout(new mc(e,f,this.outlineContext)),this.yieldChildLayout(b);case"table-row":return this.setChildLayout(new nc(e,f,this.outlineContext)),this.yieldChildLayout(b);case"table-cell":return this.setChildLayout(new oc(e,f)),this.yieldChildLayout(b)}switch(e.getMarkupName()){case"img":return e.createImage();case"hr":return e.createBlock();case"page-break":case"end-page":case"pbr":return null;case"first-line":return this.setChildLayout(new ac(e,f,this.outlineContext)),this.yieldChildLayout(b);case"details":case"blockquote":case"figure":case"fieldset":return this.setChildLayout(new hc(e,f)),this.yieldChildLayout(b);case"section":case"article":case"nav":case"aside":return this.setChildLayout(new ic(e,f,this.outlineContext)),this.yieldChildLayout(b);case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":return this.setChildLayout(new pc(e,f,this.outlineContext)),this.yieldChildLayout(b);case"ul":case"ol":return this.setChildLayout(new jc(e,f,this.outlineContext)),this.yieldChildLayout(b);default:return this.setChildLayout(new a(e,f,this.outlineContext)),this.yieldChildLayout(b)}},a.prototype._addElement=function(a,b,c){null!==b&&(this.style.isPushed()||b.pushed?a.pushBlockElement(b,c):this.style.isPulled()||b.pulled?a.pullBlockElement(b,c):a.addBlockElement(b,c),this._onAddElement(b))},a.prototype._createOutput=function(a){var b=a.getBlockCurExtent(),c=a.getBlockElements();if(0===b||0===c.length)return null;var d=this.style.createBlock({extent:b,elements:c});return this._onCreate(d),this.hasNext()||this._onComplete(d),d},a}(),$b=function(){function a(a,b,c){Yb.call(this,a,b),this.outlineContext=c||null}return g.extend(a,Yb),a.prototype._yield=function(a){if(!a.isInlineSpaceLeft())return null;for(;this.hasNext();){var b=this._getNext(a);if(null===b)break;var c=this._getMeasure(b);if(0===c)break;if(!a.hasInlineSpaceFor(c)){this.pushCache(b);break}if(this._addElement(a,b,c),!a.isInlineSpaceLeft())break}return a.isInlineEmpty()?null:(a.hasBr()||this._justifyLine(a),this._createOutput(a))},a.prototype._createChildContext=function(a){return new Vb(a.block,new Xb(a.getInlineRestMeasure()))},a.prototype._createOutput=function(a){var b=this.style.createLine({br:a.hasBr(),measure:a.getInlineCurMeasure(),elements:a.getInlineElements(),texts:a.getInlineTexts(),charCount:a.getInlineCharCount()});return this._onCreate(b),this.hasNext()||this._onComplete(b),b},a.prototype._justifyLine=function(a){var b=this.peekLastCache()||this.stream.peek(),c=a.justify(b);c&&(this.stream.setPos(c.pos+1),this.clearCache())},a.prototype._getNext=function(b){if(this.hasCache())return this.popCache(b);if(this.hasChildLayout())return this.yieldChildLayout();var c=this.stream.get();if(null===c)return null;if(C.isText(c)){if("horizontal"===this.style.getTextCombine()){this.setTerminate(!0);var d=new F(this.style.getMarkupContent());return this._getText(b,d)}return this._getText(b,c)}var e=this.style;if(c instanceof B&&(e=new Ub(c,this.style,{context:b})),e.isBlock())return this.stream.prev(),this.setTerminate(!0),b.setLineBreak(!0),null;var f=this._createStream(e,c);if(e.isInlineBlock())return new Zb(e,f,this.outlineContext).yield(b);switch(e.getMarkupName()){case"img":return e.createImage();case"br":return b.setLineBreak(!0),null;case"script":case"style":case"noscript":return this._getNext(b);case"a":return this.setChildLayout(new _b(e,f,this.outlineContext)),this.yieldChildLayout(b);default:return this.setChildLayout(new a(e,f,this.outlineContext)),this.yieldChildLayout(b)}},a.prototype._getText=function(a,b){if(C.isNewLine(b))return this.style.isPre()?null:(this.stream.skipUntil(C.isNewLine),this._getNext(a));if(b.hasMetrics()||(b instanceof D&&this._setCharKerning(a,b),b.setMetrics(this.style.flow,this.style.font)),b instanceof G)return b;switch(b._type){case"char":case"tcy":return b;case"word":return this._getWord(a,b)}},a.prototype._setCharKerning=function(a,b){var c=this.stream.peek(),d=a.getInlineLastText(),e=c&&C.isText(c)?c:null;Nb.set(b,d,e)},a.prototype._getWord=function(a,b){var c=a.getInlineRestMeasure(),d=b.getAdvance(this.style.flow,this.style.letterSpacing||0);if(c>=d)return b.setDevided(!1),b;var e=b.cutMeasure(this.style.getFontSize(),c);return e.setMetrics(this.style.flow,this.style.font),b.setMetrics(this.style.flow,this.style.font),this.stream.prev(),e.bodySize=Math.min(c,e.bodySize),e},a.prototype._getMeasure=function(a){return a instanceof rb?a.getLayoutMeasure(this.style.flow):a.getAdvance?a.getAdvance(this.style.flow,this.style.letterSpacing||0):0},a.prototype._addElement=function(a,b,c){a.addInlineElement(b,c),this._onAddElement(b)},a}(),_b=function(){function a(a,b,c){$b.call(this,a,b,c)}return g.extend(a,$b),a.prototype._onComplete=function(){var a=this.style.getMarkupAttr("name");a&&Ab.addAnchor(a)},a}(),ac=function(){function a(a,b,c){Zb.call(this,a,b,c)}return g.extend(a,Zb),a.prototype._onAddElement=function(a){"inline"===a.display&&"undefined"==typeof this._first&&(this._first=!0,this.style=this.style.parent,this._childLayout&&(this._childLayout.style=this.style))},a}(),bc=function(){function a(a,b){Yb.call(this,a,null),this.block=b}return g.extend(a,Yb),a.prototype.yield=function(){return this._terminate?null:(this._terminate=!0,this.block)},a}(),cc=function(){function a(a,b,c){Zb.call(this,a,b,c)}return g.extend(a,Zb),a.prototype.yield=function(a){return this.cloneStyle({measure:a.getBlockRestExtent(),extent:a.getInlineMaxMeasure()}),Zb.prototype.yield.call(this)},a}(),dc=function(){function a(a,b){this.elements=a||[],this.floatDirection=b||Pb.get("start")}return a.prototype={add:function(a){this.elements.unshift(a)},isFloatStart:function(){return this.floatDirection.isStart()},isFloatEnd:function(){return this.floatDirection.isEnd()},getElements:function(){return this.isFloatStart()?this.elements:h.reverse(this.elements)},getMeasure:function(a){return h.fold(this.elements,0,function(b,c){return b+c.getLayoutMeasure(a)})},getExtent:function(a){return h.fold(this.elements,0,function(b,c){return Math.max(b,c.getLayoutExtent(a))})}},a}(),ec=function(){function a(a,b,d){var e=c(a,Pb.get("start"),b),f=c(a,Pb.get("end"),d);this.stack=e.concat(f).sort(function(b,c){return b.getExtent(a)-c.getExtent(a)})}var b=function(a,b,c){var d=c.pop()||null;if(null===d)return null;for(var e=d.getLayoutExtent(a),f=new dc([d],b);;){var g=c.pop();if(!(g&&g.getLayoutExtent(a)<=e)){c.push(g);break}f.add(g)}return f},c=function(a,c,d){var e=[];do{var f=b(a,c,d);f&&e.push(f)}while(null!==f);return e};return a.prototype={isEmpty:function(){return 0===this.stack.length},pop:function(){return this.stack.pop()||null}},a}(),fc=function(){function a(a,b,c,d){Zb.call(this,a,b,d),this.generators=this._getFloatedGenerators(c),this.setChildLayout(new Zb(a.clone({"float":"start"}),b,d))}return g.extend(a,Yb),a.prototype.hasNext=function(){return this._hasNextFloat()?!0:Yb.prototype.hasNext.call(this)},a.prototype._hasNextFloat=function(){return h.exists(this.generators,function(a){return a.hasNext()})},a.prototype._yield=function(a){var b=this._yieldFloatStack(a),c=a.getInlineRestMeasure(),d=a.getBlockRestExtent();return this._yieldFloat(a,b,c,d)},a.prototype._yieldFloat=function(a,b,c,d){if(0>=c)return null;var e=this.style.flow;if(b.isEmpty())return this._yieldFloatSpace(a,c,d);var f=b.pop(),g=this._yieldFloat(a,b,c-f.getMeasure(e),f.getExtent(e)),h=this._wrapFloat(f,g,c),i=d-f.getExtent(e);if(0>=i||!this.stream.hasNext())return h;var j=this._yieldFloatSpace(a,c,i);return this._wrapBlock(h,j)},a.prototype._sortFloatRest=function(a,b){var c=a.getElements();return a.isFloatStart()?c.concat(b):[b].concat(c)},a.prototype._wrapBlock=function(a,b){var c=this.style.flow,d=a.getLayoutMeasure(c),e=a.getLayoutExtent(c)+(b?b.getLayoutExtent(c):0),f=b?[a,b]:[a];return this.style.createChild("div",{"float":"start",measure:d}).createBlock({elements:f,extent:e})},a.prototype._wrapFloat=function(a,b,c){var d=this.style.flow,e=a.getExtent(d);return this.style.createChild("div",{"float":"start",measure:c}).createBlock({elements:this._sortFloatRest(a,b),extent:e})},a.prototype._yieldFloatSpace=function(a,b,c){return this._childLayout.cloneStyle({"float":"start",measure:b,extent:c}),this.yieldChildLayout()},a.prototype._yieldFloatStack=function(a){var b=[],c=[];return h.iter(this.generators,function(d){var e=d.yield(a);e&&(d.style.isFloatStart()?b.push(e):d.style.isFloatEnd()&&c.push(e))}),new ec(this.style.flow,b,c)},a.prototype._getFloatedGenerators=function(a){var b=this;return h.map(this._getFloatedTags(a),function(c){return b._createFloatBlockGenerator(c,a)})},a.prototype._getFloatedTags=function(a){var b=this.style;return this.stream.getWhile(function(c){return c instanceof B&&new Ub(c,b,{context:a}).isFloated()})},a.prototype._createFloatBlockGenerator=function(a,b){var c=new Ub(a,this.style,{context:b});return"img"===c.getMarkupName()?new bc(c,c.createImage()):new Zb(c,this._createStream(c,a),this.outlineContext)},a}(),gc=function(){function a(a,b){Yb.call(this,a,null),this.generators=b}return g.extend(a,Yb),a.prototype._yield=function(a){if(this.hasCache())return this.popCache();var b=this._yieldParallelBlocks(a);if(null===b)return null;var c=this._wrapBlocks(b),d=c.getLayoutExtent(this.style.flow);return a.hasBlockSpaceFor(d)?(a.addBlockElement(c,d),c):(this.pushCache(c),null)},a.prototype.hasNext=function(){return this._terminate?!1:this.hasCache()?!0:h.exists(this.generators,function(a){return a.hasNext()})},a.prototype._yieldParallelBlocks=function(a){var b=h.map(this.generators,function(b){return b.yield(a)});return h.forall(b,function(a){return null===a})?null:b},a.prototype._findMaxBlock=function(a){var b=this.style.flow;return h.maxobj(a,function(a){return a?a.getLayoutExtent(b):0})},a.prototype._alignContentExtent=function(a,b){var c=this.style.flow,d=this.generators;return h.mapi(a,function(a,e){return null===e?d[a].style.createBlock({elements:[],extent:b}):e.resizeExtent(c,b)})},a.prototype._wrapBlocks=function(a){var b=this.style.flow,c=(this.generators,this._findMaxBlock(a)),d=this._alignContentExtent(a,c.getContentExtent(b));return this.style.createBlock({elements:d,extent:c.getLayoutExtent(b)})},a}(),hc=function(){function a(a,b){Zb.call(this,a,b),this.outlineContext=new wb(a)}return g.extend(a,Zb),a.prototype._onComplete=function(){Ab.addOutlineContext(this.outlineContext)},a}(),ic=function(){function a(a,b,c){Zb.call(this,a,b,c),this.outlineContext.startSection(this.style.getMarkupName())}return g.extend(a,Zb),a.prototype._onComplete=function(){this.outlineContext.endSection(this.style.getMarkupName())},a}(),jc=function(){function a(a,b,c){Zb.call(this,a,b,c),this.style.markerSize=this._getMarkerSize(this.stream.getTokenCount())}return g.extend(a,Zb),a.prototype._getMarkerSize=function(a){var b=this.style.getMarkerHtml(a),c=new $b(this.style.clone(),new Bb(b)),d=c.yield(),e=d?d.inlineMeasure+Math.floor(this.style.getFontSize()/2):this.style.getFontSize(),f=d?d.size.getExtent(this.style.flow):this.style.getFontSize();return this.style.flow.getBoxSize(e,f)},a}(),kc=function(){function a(a,b,c){gc.call(this,a,[this._createListMarkGenerator(a,c),this._createListBodyGenerator(a,b,c)])}return g.extend(a,gc),a.prototype._createListMarkGenerator=function(a,b){var c=a.parent.markerSize,d=a.getChildIndex(),e=a.parent.getMarkerHtml(d+1),f=c.getMeasure(a.flow),g=a.createChild("li-marker",{"float":"start","class":"nehan-li-mark",measure:f});return new Zb(g,new Bb(e),b)},a.prototype._createListBodyGenerator=function(a,b,c){var d=a.parent.markerSize,e=a.contentMeasure-d.getMeasure(a.flow),f=a.createChild("li-body",{"float":"start","class":"nehan-li-body",measure:e});return new Zb(f,b,c)},a.prototype._alignContentExtent=function(a,b){return this.style.isTextVertical()?a:gc.prototype._alignContentExtent.call(this,a,b)},a}(),lc=function(){function a(a,b){Zb.call(this,a,b)}return g.extend(a,Zb),a}(),mc=function(){function a(a,b){Zb.call(this,a,b)}return g.extend(a,Zb),a}(),nc=function(){function a(a,b,c){var d=this._getGenerators(a,b,c);gc.call(this,a,d)}return g.extend(a,gc),a.prototype._getGenerators=function(a,b,c){var d=this._getChildTags(b),e=this._getChildStyles(a,d);return h.map(e,function(a){return new oc(a,new Bb(a.getMarkupContent()),c)})},a.prototype._getChildStyles=function(a,b){var c=b.length,d=a.contentMeasure;return h.mapi(b,function(b,e){var f=new Ub(e,a),g=f.staticMeasure,h=g&&d>=g?g:Math.floor(d/(c-b));return d-=h,f.clone({"float":"start",measure:h})})},a.prototype._getChildTags=function(a){return a.getWhile(function(a){return a instanceof B&&("td"===a.getName()||"th"===a.getName())})},a}(),oc=function(){function a(a,b){hc.call(this,a,b),this.outlineContext=new wb(a)}return g.extend(a,hc),a}(),pc=function(){function a(a,b,c){Zb.call(this,a,b,c)}return g.extend(a,Zb),a.prototype._getHeaderRank=function(){return this.style.getMarkupName().match(/h([1-6])/)?parseInt(RegExp.$1,10):0},a.prototype._onComplete=function(a){var b=this.outlineContext.addHeader({type:this.style.getMarkupName(),rank:this._getHeaderRank(),title:this.style.getMarkupContent()});a.id=o.addNehanHeaderPrefix(b)},a}(),qc=function(){function a(a){var b=new B("<body>",a);hc.call(this,new Ub(b,null),new Bb(a))}return g.extend(a,hc),a.prototype._onCreate=function(a){a.seekPos=this.stream.getSeekPos(),a.percent=this.stream.getSeekPercent(),a.pageNo=Ab.pageNo++},a}(),rc=function(){function a(a){this.stream=new Eb(a),this.generator=this._createGenerator()}return a.prototype={"yield":function(){return this.generator.yield()},hasNext:function(){return this.generator.hasNext()},_createGenerator:function(){for(;this.stream.hasNext();){var a=this.stream.get();switch(a.getName()){case"head":this._parseDocumentHeader(new Fb(a.getContent()));break;case"body":return this._createBodyGenerator(a.getContent())}}return this._createBodyGenerator(this.stream.getSrc())},_createBodyGenerator:function(a){return new qc(a)},_parseDocumentHeader:function(a){for(var b=new zb;a.hasNext();){var c=a.get();switch(c.getName()){case"title":b.setTitle(c.getContent());break;case"meta":b.addMeta(c);break;case"link":b.addLink(c);break;case"style":b.addStyle(c);break;case"script":b.addScript(c)}}Ab.documentHeader=b}},a}(),sc=function(){function a(a){this.stream=new Db(a),this.generator=this._createGenerator()}return a.prototype={"yield":function(){return this.generator.yield()},hasNext:function(){return this.generator.hasNext()},_createGenerator:function(){for(;this.stream.hasNext();){var a=this.stream.get();switch(a.getName()){case"!doctype":Ab.documentType="html";break;case"html":return this._createHtmlGenerator(a)}}var b=new B("<html>",this.stream.getSrc());return this._createHtmlGenerator(b)},_createHtmlGenerator:function(a){return new rc(a.getContent())}},a}(),tc=function(){function a(){}return a.prototype={evaluate:function(a){if(null===a||"undefined"==typeof a)return"";if(this.isFlipBox(a)){var b=this.getFlipEvaluator();return b.evaluate(a)}switch(a.display){case"block":return this.evalBlock(a);case"inline":return this.evalInline(a);case"inline-block":return this.evalInlineBlock(a);default:return""}},evalBlock:function(a){return p.tagWrap("div",this.evalBlockElements(a,a.elements),r.copy({style:o.toString(a.getCssBlock()),"class":a.classes.join(" ")},a.getDatasetAttr()))},evalBlockElements:function(a,b){var c=this;return h.fold(b,"",function(b,d){return b+(d?c.evalBlockElement(a,d):"")})},evalBlockElement:function(a,b){return b.style&&"img"===b.style.getMarkupName()?this.evalBlockImage(b):this.evaluate(b)},evalInlineBlock:function(a){return p.tagWrap("div",this.evalBlockElements(a,a.elements),r.copy({style:o.toString(a.getCssInlineBlock()),"class":a.classes.join(" ")},a.getDatasetAttr()))},evalInline:function(a){return p.tagWrap("div",this.evalInlineElements(a,a.elements),{style:o.toString(a.getCssInline()),"class":a.classes.join(" ")})},evalInlineElements:function(a,b){var c=this;return h.fold(b,"",function(b,d){return b+c.evalInlineElement(a,d)})},evalInlineElement:function(a,b){if("inline-block"===b.display)return this.evalInlineBlock(b);if(b instanceof rb)switch(b.style.getMarkupName()){case"img":return this.evalInlineImage(a,b);case"a":return this.evalLink(a,b);default:return this.evalInlineChild(a,b)}var c=this.evalTextElement(a,b);return a.style.isTextEmphaEnable()?this.evalEmpha(a,b,c):c},evalLink:function(a,b){var d=b.style.getMarkupAttr("title")||b.style.getMarkupContent().substring(0,c.defaultLinkTitleLength),e=new nb(b.style.getMarkupAttr("href")),f=e.getAnchorName(),g=f?Ab.getAnchorPageNo(f):"";return this.evalLinkElement(a,b,{title:d,href:e.getAddress(),pageNo:g})},evalTextElement:function(a,b){switch(b._type){case"word":return this.evalWord(a,b);case"char":return this.evalChar(a,b);case"tcy":return this.evalTcy(a,b);case"ruby":return this.evalRuby(a,b);default:return""}}},a}(),uc=function(){function a(){tc.call(this)}return g.extend(a,tc),a.prototype.getFlipEvaluator=function(){return new vc},a.prototype.isFlipBox=function(a){return a.style.isTextHorizontal()},a.prototype.evalInlineChild=function(a,b){return this.evalInline(b)},a.prototype.evalLinkElement=function(a,b,c){return p.tagWrap("a",this.evalInline(b),r.copy({"class":b.classes.join(" "),href:c.href,title:c.title,"data-page":c.pageNo},b.getDatasetAttr()))},a.prototype.evalBlockImage=function(a){return p.tagSingle("img",r.copy({src:a.style.getMarkupAttr("src"),style:o.toString(a.getCssBlock()),title:a.style.getMarkupAttr("title")||"no title","class":a.classes.join(" ")},a.getDatasetAttr()))},a.prototype.evalInlineImage=function(a,b){return p.tagSingle("img",r.copy({src:b.style.getMarkupAttr("src"),style:o.toString(b.getCssInline()),title:b.style.getMarkupAttr("title")||"no title","class":b.classes.join(" ")},b.getDatasetAttr()))+"<br />"},a.prototype.evalRuby=function(a,b){var c=this.evalRb(a,b)+this.evalRt(a,b);return p.tagWrap("div",c,{"class":"nehan-ruby-body"})},a.prototype.evalRb=function(a,b){return p.tagWrap("div",this.evalInlineElements(a,b.getRbs()),{style:o.toString(b.getCssVertRb(a)),"class":"nehan-rb"})},a.prototype.evalRt=function(a,b){var c=new $b(new Ub(b.rt,a.style),new Bb(b.getRtString()),null).yield();return r.copy(c.css,b.getCssVertRt(a)),this.evaluate(c)},a.prototype.evalWord=function(a,b){return e.isTransformEnable?e.isTrident?this.evalWordTransformTrident(a,b):this.evalWordTransform(a,b):e.isIE?this.evalWordIE(a,b):""},a.prototype.evalWordTransform=function(a,b){var c=p.tagWrap("div",b.data,{"class":"nehan-rotate-90",style:o.toString(b.getCssVertTransBody(a))});return p.tagWrap("div",c,{style:o.toString(b.getCssVertTrans(a))})},a.prototype.evalWordTransformTrident=function(a,b){var c=p.tagWrap("div",b.data,{style:o.toString(b.getCssVertTransBodyTrident(a))});return p.tagWrap("div",c,{style:o.toString(b.getCssVertTrans(a))})},a.prototype.evalWordIE=function(a,b){return p.tagWrap("div",b.data,{"class":"nehan-vert-ie",style:o.toString(b.getCssVertTransIE(a))})+n.clearFix},a.prototype.evalRotateChar=function(a,b){return e.isTransformEnable?this.evalRotateCharTransform(a,b):e.isIE?this.evalRotateCharIE(a,b):this.evalCharWithBr(a,b)},a.prototype.evalRotateCharTransform=function(a,b){return p.tagWrap("div",b.data,{"class":"nehan-rotate-90"})},a.prototype.evalRotateCharIE=function(a,b){return p.tagWrap("div",b.data,{style:o.toString(b.getCssVertRotateCharIE(a)),"class":"nehan-vert-ie"})+n.clearFix},a.prototype.evalTcy=function(a,b){return p.tagWrap("div",b.data,{"class":"nehan-tcy"})},a.prototype.evalChar=function(a,b){return b.isImgChar()?b.isVertGlyphEnable()?this.evalVerticalGlyph(a,b):this.evalImgChar(a,b):b.isHalfSpaceChar(b)?this.evalHalfSpaceChar(a,b):b.isCnvChar()?this.evalCnvChar(a,b):b.isRotateChar()?this.evalRotateChar(a,b):b.isSmallKana()?this.evalSmallKana(a,b):b.isPaddingEnable()?this.evalPaddingChar(a,b):a.letterSpacing?this.evalCharLetterSpacing(a,b):this.evalCharWithBr(a,b)},a.prototype.evalCharWithBr=function(a,b){return b.data+"<br />"},a.prototype.evalCharLetterSpacing=function(a,b){return p.tagWrap("div",b.data,{style:o.toString(b.getCssVertLetterSpacing(a))})},a.prototype.evalEmpha=function(a,b,c){c=c.replace("<br />","");var d=p.tagWrap("span",c,{"class":"nehan-empha-src",style:o.toString(b.getCssVertEmphaTarget(a))}),e=p.tagWrap("span",a.style.textEmpha.getText(),{"class":"nehan-empha-text",style:o.toString(b.getCssVertEmphaText(a))});return p.tagWrap("div",d+e,{"class":"nehan-empha-wrap",style:o.toString(a.style.textEmpha.getCssVertEmphaWrap(a,b))})},a.prototype.evalPaddingChar=function(a,b){return p.tagWrap("div",b.data,{style:o.toString(b.getCssPadding(a))})},a.prototype.evalImgChar=function(a,b){var c=a.color||new I(d.fontColor),e=c.getRgb(),f=K.getColor(e).toUpperCase();return p.tagSingle("img",{"class":"nehan-img-char",src:b.getImgSrc(f),style:o.toString(b.getCssVertImgChar(a))})+n.clearFix
},a.prototype.evalVerticalGlyph=function(a,b){return p.tagWrap("div",b.data,{"class":"nehan-vert-glyph",style:o.toString(b.getCssVertGlyph(a))})},a.prototype.evalCnvChar=function(a,b){return b.cnv+"<br />"},a.prototype.evalSmallKana=function(a,b){var c=a.style.textEmpha&&a.style.textEmpha.isEnable()?"span":"div";return p.tagWrap(c,b.data,{style:o.toString(b.getCssVertSmallKana())})},a.prototype.evalHalfSpaceChar=function(a,b){{var c=a.style.getFontSize();Math.round(c/2)}return p.tagWrap("div","&nbsp;",{style:o.toString(b.getCssVertHalfSpaceChar(a))})},a.prototype.evalInlineBox=function(a,b){var c="img"===b._type?this.parentEvaluator.evalImageContent(b):b.content;return p.tagWrap("div",c,{style:o.toString(b.getCssVertInlineBox())})},a}(),vc=function(){function a(){tc.call(this)}return g.extend(a,tc),a.prototype.getFlipEvaluator=function(){return new uc},a.prototype.isFlipBox=function(a){return a.style.isTextVertical()},a.prototype.evalBlockImage=function(a){return p.tagSingle("img",r.copy({src:a.style.getMarkupAttr("src"),style:o.toString(a.getCssBlock()),title:a.style.getMarkupAttr("title")||"no title","class":a.classes.join(" ")},a.getDatasetAttr()))},a.prototype.evalInlineImage=function(a,b){return p.tagSingle("img",r.copy({src:b.style.getMarkupAttr("src"),style:o.toString(b.getCssHoriInlineImage()),title:b.style.getMarkupAttr("title")||"no title","class":b.classes.join(" ")},b.getDatasetAttr()))},a.prototype.evalInlineChild=function(a,b){return p.tagWrap("span",this.evalInlineElements(b,b.elements),r.copy({style:o.toString(b.getCssInline()),"class":a.classes.join(" ")},b.getDatasetAttr()))},a.prototype.evalLinkElement=function(a,b,c){return p.tagWrap("a",this.evalInlineElements(b,b.elements),r.copy({"class":b.classes.join(" "),href:c.href,title:c.title,"data-page":c.pageNo},b.getDatasetAttr()))},a.prototype.evalRuby=function(a,b){var c=this.evalRt(a,b)+this.evalRb(a,b);return p.tagWrap("span",c,{style:o.toString(b.getCssHoriRuby(a)),"class":"nehan-ruby-body"})},a.prototype.evalRb=function(a,b){return p.tagWrap("div",this.evalInlineElements(a,b.getRbs()),{style:o.toString(b.getCssHoriRb(a)),"class":"nehan-rb"})},a.prototype.evalRt=function(a,b){return p.tagWrap("div",b.getRtString(),{style:o.toString(b.getCssHoriRt(a)),"class":"nehan-rt"})},a.prototype.evalWord=function(a,b){return b.data},a.prototype.evalTcy=function(a,b){return b.data},a.prototype.evalChar=function(a,b){return b.isHalfSpaceChar()?b.cnv:b.isKerningChar()?this.evalKerningChar(a,b):b.data},a.prototype.evalEmpha=function(a,b,c){var d=p.tagWrap("div",c,{style:o.toString(b.getCssHoriEmphaTarget(a))}),e=p.tagWrap("div",a.style.textEmpha.getText(),{style:o.toString(b.getCssHoriEmphaText(a))});return p.tagWrap("span",e+d,{style:o.toString(a.style.textEmpha.getCssHoriEmphaWrap(a,b))})},a.prototype.evalKerningChar=function(a,b){var c=b.getCssPadding(a);return b.isKakkoStart()?(c["margin-left"]="-0.5em",p.tagWrap("span",b.data,{style:o.toString(c),"class":"nehan-char-kakko-start"})):b.isKakkoEnd()?(c["margin-right"]="-0.5em",p.tagWrap("span",b.data,{style:o.toString(c),"class":"nehan-char-kakko-end"})):b.isKutenTouten()?(c["margin-right"]="-0.5em",p.tagWrap("span",b.data,{style:o.toString(c),"class":"nehan-char-kuto"})):b.data},a.prototype.evalPaddingChar=function(a,b){return p.tagWrap("span",b.data,{style:o.toString(b.getCssPadding(a))})},a}();return r.copy(d,b.layout||{}),r.copy(c,b.config||{}),Nehan.version="5.0.0",Nehan.Class=g,Nehan.Env=e,{documentContext:Ab,createPageStream:function(a,b){return b=Math.max(1,b||1),1===b?new Kb(a,1):new Mb(a,b)},getStyle:function(a){return z.getValue(a)},setStyle:function(a,b){return z.setValue(a,b),this},setStyles:function(a){for(var b in a)z.setValue(b,a[b]);return this}}};